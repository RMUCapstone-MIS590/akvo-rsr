{% extends "rsr/base.html" %}

{% load i18n rsr_tags rsr_filters webdesign thumbnail counter_tags cache humanize sorting_tags pagination_tags %}

{% block title %}
  {% if org %}
    - {% trans 'Project listing for' %} {{org.name}}
  {% else %}
    {% if focus_area.slug != 'all' %}
      - {% trans 'Projects' %} - {{focus_area.name}}
    {% else %}
      - {% trans 'All projects' %}
    {% endif %}
  {% endif %}
{% endblock title %}


{% block breadcrum_items %}
  {% if org %}
    {{block.super}}
      <li><a href="{% url project_list %}"><span>{% trans 'Projects' %}</span></a></li>
      <li id="last_breadcrum_item">{% trans 'Project listing for' %} {{org.name}}</li>
  {% else %}
    {% if focus_area.slug != 'all' %}
      {{block.super}}
        <li><a href="{% url project_list %}"><span>{% trans 'Projects' %}</span></a></li>
        <li id="last_breadcrum_item">{{focus_area.name}}</li>
    {% else %}
      {{block.super}}
        <li id="last_breadcrum_item">{% trans 'All projects' %}</li>
    {% endif %}
  {% endif %}
{% endblock breadcrum_items %}

{% block maincontent %}

<div class='container'>

  <div class='column span-14'>
    {% if org %}
      <h1 class="h0"><a href="{{org.get_absolute_url}}">{% trans 'Project listing for' %} {{org.name}}</a></h1>
      <div class='column span-14 last'>
        <a href="{{org.get_absolute_url}}">{% org_logo org 240 180 'float: left; margin: 0 20px 20px 0;' %}</a>
        <p>
          {{org.description|linebreaks}}
        </p>
      </div>    
    {% else %}
      {% if focus_area %}
        <h1 class="h0">{{focus_area}} {% trans 'projects' %}</h1>
        <div class='column span-11'>
          <img width="240" height="180" style="float: left; margin: 0 20px 20px 0;" src="{% thumbnail focus_area.image 240x180 sharpen %}" alt="{{focus_area}}"/>
          <p>
            {{focus_area.description|linebreaks}}
          </p>
        </div>
        {% if focus_area.slug != 'all' %}
          <div class='column span-3 last'>
            <div class="white_box blue_tint">
              <div class="space20">
                <h2>Related focus area</h2>
                <a href="/web/{{focus_area.slug}}" class="small">{% trans 'Learn more about'%} <br/>{{focus_area}}&nbsp;<span class="link_triangle">&#x25B6;</span></a>
              </div>
            </div>
          </div>
        {% endif %}
      {% else %}  
        <h1 class="h0">{% trans 'All projects' %}</h1>
        <div class='column span-14 last'>
          <img width="240" height="180" style="float: left; margin: 0 20px 20px 0;" src="{{MEDIA_URL}}pvw-take2/img/meisje-drinkt-water-240x180.jpg" alt="{{focus_area}}"/>
          <p>
            {% trans 'Accumsan et iusto odio dignissim qui blandit praesent luptatum? Consuetudium lectorum mirum est notare quam littera gothica quam nunc putamus parum claram. In iis qui facit eorum claritatem Investigationes demonstraverunt. Typi qui nunc nobis videntur parum clari fiant sollemnes in.' %}
          </p>
        </div>    
      {% endif %}
    {% endif %}
    <div class='column span-14 last'>
      <h1>{% trans 'Our projects' %}
        <span class="lt_grey">
          {% blocktrans count projects.count as projects_count %}
            ({{projects_count}} result)
          {% plural %}
            ({{projects_count}} results)
          {% endblocktrans %}
        </span>
      </h1>
      {% autosort projects %}
      {% autopaginate projects 10 %}
      <div class="white_box">
        {% paginate %}
        <table id="projects">
          <colgroup class="name_col"></colgroup>
          <colgroup span="6" class="colgroup"></colgroup>
          <tr>
            <th style="padding: 10px;">
              {% anchor name Name %}
            </th>
            <!--<th class="activeTableHeaderDesc">
              <a href="#" class="small">
                <div class="activeTableHeaderDesc">Country</div>
              </a>
            </th>-->
            <th>{% anchor country Country %}</th>
            <th>
               {% anchor country__continent Continent %}
            </th>
            <th>
              {% anchor status Status %}
            </th>
            <th>
              {% anchor latest_update 'Latest update' %}
            </th>
            <th>
                <p class="small">Partners</p>
            </th>
            <th style="border-right: 0;">
                <p class="small">Focus area</p>
            </th>
          </tr>
          {% for project in projects %}
            <tr>
              <td>
                <div class="space10">
                  <a href="{% url project_main project.id %}">
                    {% project_thumb project 100 75 'float:left; margin: 0 10px 10px 0;' %}
                    <p class="nano-lede strong link_blue">
                        {{project.name}}
                    </p> 
                  </a>
                  <p class="nano-lede">
                    {{project.project_plan_summary|capfirst|smart_truncate:100}}
                  </p> 
                </div>
              </td>
              <td>
                <p class="td-text">{{project.country}}</p>
              </td>
              <td>
                <p class="td-text">{{project.country.get_continent_display}}</p>
              </td>
              <td>
                <p class="td-text green">{{project.show_status}}</p>
              </td>
              <td>
                <p class="td-text">
                    {% if project.latest_update %}
                      <a href="{% url project_updates project.id %}#{{project.update_id}}">{{project.latest_update|string_to_date|date:"d M Y"}}</a>
                    {% else %}
                      {% trans 'Not yet' %}
                    {% endif %}
                </p>
              </td>
              <td>
                <p class="td-text">
                  {% for partner in project.project_partners.all %}
                    <a href="{% url org_detail partner.partner.id %}">{{partner.partner}}</a>{% if not forloop.last %}<br />{% endif %}
                  {% endfor %}
                </p>
              </td>
              <td>
                <p class="td-text">
                    {% for area in project.focus_areas %}
                        <a href="{% url focus_area area.slug %}">{{area.name}}</a><br/>
                    {% endfor %}
                </p>
              </td>
            </tr>
          {% endfor %}
        </table>
        {% paginate %}
      </div>
    </div>
  </div>

</div> 

{% endblock maincontent %}

{% block js %}

{{ block.super }}

{% if debug %}
  <script type="text/javascript" src="{{MEDIA_URL}}js/jquery-ui.min.js"></script>
{% else %}
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
{% endif %}

{% endblock js %}

{% block jq_ready %}

  jQ('#project_tabs').tabs();
  {{block.super}}

{% endblock jq_ready %}