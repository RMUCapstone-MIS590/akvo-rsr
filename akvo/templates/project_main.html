{% extends "base.html" %}
{% load compressed i18n rsr_utils rsr_tags rules %}
{% load rsr_filters humanize markup_tags %}
{% block title %}{{ project.title }}{% endblock title %}
{% block maincontent %}
    <div class="header-container">
      {% include "partials/project_header.html" %}
    </div>
    <div class="tab-menu container">
      <div class="row">
        <a href="#summary" class="tab-link selected">{% trans 'Summary' %}</a>
        <a href="#report" class="tab-link">{% trans 'Full report' %}</a>
        {% if project.partners.all %}<a href="#partners" class="tab-link">{% trans 'Project partners' %}</a>{% endif %}
        <a href="#finance" class="tab-link">{% trans 'Finances' %}</a>
        {% if project.is_impact_project and project.results.all %}<a href="#results" class="tab-link">{% trans 'Results' %}</a>{% endif %}
        {% if updates %}<a href="#updates" class="tab-link">{% trans 'Updates' %}</a>{% endif %}
      </div>
    </div>
    {% include "project_main_tabs/summary.html" %}
    {% include "project_main_tabs/report.html" %}
    {% include "project_main_tabs/partners.html" %}
    {% include "project_main_tabs/finance.html" %}
    {% if project.is_impact_project and project.results.all %}
        {% include "project_main_tabs/results.html" %}
    {% endif %}
    {% if updates %}
        {% include "project_main_tabs/updates.html" %}
    {% endif %}
    {% include "partials/project_footer.html" %}
{% endblock %}

{% block js %}
    {{ block.super }}

    {# React #}
    <script id="react" src="//fb.me/react-0.14.7.min.js"></script>
    <script id="react-dom" src="//fb.me/react-dom-0.14.7.min.js"></script>
    <script id="react-bootstrap" src="//cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.28.3/react-bootstrap.min.js"></script>

    {# Descriptions #}
    <script type="application/json" id="akvo-rsr-accordion">
        {{ accordion_data|safe }}
    </script>

    {# Update photos #}
    <script type="application/json" id="akvo-rsr-carousel">
        {{ carousel_data|safe }}
    </script>

    {# Default values #}
    <script type="application/json" id="default-values">
        {
            "show_partners_tab": {% if project.partners.all %}true{% else %}false{% endif %},
            "show_updates_tab": {% if updates %}true{% else %}false{% endif %},
            "show_results_tab": {% if project.results.all %}true{% else %}false{% endif %}
        }
    </script>

    {# Translation strings #}
    <script type="application/json" id="project-main-text">
        {
            "end_date_unknown_text": "{% trans 'End date unknown' %}",
            "start_date_unknown_text": "{% trans 'Start date unknown' %}",
            "actual_text": "{% trans 'actual' %}",
            "target_text": "{% trans 'target' %}",
            "background_text": "{% trans 'Background' %}",
            "current_situation_text": "{% trans 'Situation at start of project' %}",
            "goals_overview_text": "{% trans 'Goals overview' %}",
            "project_plan_text": "{% trans 'Project plan' %}",
            "sustainability_text": "{% trans 'Sustainability' %}",
            "target_group_text": "{% trans 'Target group' %}",
            "results_text": "{% trans 'Results and indicators' %}",
            "delete_confirm_text": "{% trans 'Are you sure you want to delete this update?' %}",
            "delete_confirm_yes_text": "{% trans 'Delete update' %}",
            "delete_confirm_cancel_text": "{% trans 'Cancel' %}"
        }
    </script>

    {###### RESULTS FRAMEWORK ######}
    {% if project.is_impact_project and project.results.all %}

        {#  Initial data endpoints #}
        <script type="application/json" id="data-endpoints">
            {
                "base_url": "http://{{ request.META.HTTP_HOST }}",
                "result": "/rest/v1/result/{result}/?format=json",
                "results_of_project": "/rest/v1/result/?format=json&project={project}",
                "indicators_of_project": "/rest/v1/indicator/?format=json&result__project={project}",
                "periods_of_project": "/rest/v1/indicator_period/?format=json&indicator__result__project={project}",
                "updates_and_comments_of_project": "/rest/v1/indicator_period_data_framework/?format=json&period__indicator__result__project={project}",
                "period_framework": "/rest/v1/indicator_period_framework/{period}/?format=json",
                "update_and_comments": "/rest/v1/indicator_period_data_framework/{update}/?format=json",
                "updates_and_comments": "/rest/v1/indicator_period_data_framework/?format=json",
                "comments": "/rest/v1/indicator_period_data_comment/?format=json",
                "user": "/rest/v1/user/{{ user.pk }}/?format=json",
                "partnerships": "/rest/v1/partnership/?format=json&project={{ project.pk }}",
                "file_upload": "/rest/v1/indicator_period_data/{update}/upload_file/?format=json"
            }
        </script>

        {# Project id's #}
        <script type="application/json" id="project-ids">
            {
                "project_id": {{ project.pk }},
                "parent_projects_ids": {{ parent_projects_ids }},
                "child_projects_ids": {{ child_projects_ids }}
            }
        </script>

        {# Months #}
        <script type="application/json" id="months">
            {
                "january": "{% trans 'Jan' %}",
                "february": "{% trans 'Feb' %}",
                "march": "{% trans 'Mar' %}",
                "april": "{% trans 'Apr' %}",
                "may": "{% trans 'May' %}",
                "june": "{% trans 'Jun' %}",
                "july": "{% trans 'Jul' %}",
                "august": "{% trans 'Aug' %}",
                "september": "{% trans 'Sep' %}",
                "october": "{% trans 'Oct' %}",
                "november": "{% trans 'Nov' %}",
                "december": "{% trans 'Dec' %}"
            }
        </script>

        {# Translation strings #}
        <script type="application/json" id="translation-texts">
            {
                "results": "{% trans 'Results' %}",
                "indicator": "{% trans 'Indicator' %}",
                "indicators": "{% trans 'Indicators' %}",
                "indicator_period": "{% trans 'Indicator period' %}",
                "indicator_periods": "{% trans 'Indicator periods' %}",
                "unit": "{% trans 'Unit' %}",
                "percentage": "{% trans 'Percentage' %}",
                "baseline_year": "{% trans 'Baseline year' %}",
                "baseline_value": "{% trans 'Baseline value' %}",
                "period": "{% trans 'Period' %}",
                "loading": "{% trans 'Loading' %}",
                "number_of_pending_updates": "{% trans 'Number of pending updates' %}",
                "lock_period": "{% trans 'Lock period' %}",
                "unlock_period": "{% trans 'Unlock period' %}",
                "period_locked": "{% trans 'Period locked' %}",
                "parent_project": "{% trans 'Parent project' %}",
                "child_project": "{% trans 'Child project' %}",
                "request_update": "{% trans 'Request update' %}",
                "actual_value": "{% trans 'Actual value' %}",
                "actual_value_info": "{% trans 'This is the total of all indicator updates for this period' %}",
                "target_value": "{% trans 'Target value' %}",
                "target_comment": "{% trans 'Target comment' %}",
                "current": "{% trans 'Current' %}",
                "add_to_actual_value": "{% trans 'Add to actual value' %}",
                "input_placeholder": "{% trans 'Fill in a value to add to the actual value' %}",
                "actual_value_comment": "{% trans 'Comment' %}",
                "comment_placeholder": "{% trans 'Add a comment to provide additional background information for this update' %}",
                "new_total_value": "{% trans 'New total for this period' %}",
                "total_value_after_update": "{% trans 'Actual total for this period (after this update)' %}",
                "update": "{% trans 'Indicator Update' %}",
                "updates": "{% trans 'Indicator Updates' %}",
                "no_updates_yet": "{% trans 'This period has no updates yet' %}",
                "new_update": "{% trans 'New indicator update' %}",
                "adding_update": "{% trans 'Adding new update' %}",
                "edit_update": "{% trans 'Edit update' %}",
                "cancel": "{% trans 'Cancel' %}",
                "delete": "{% trans 'Delete' %}",
                "save": "{% trans 'Save' %}",
                "submit_for_approval": "{% trans 'Submit for approval' %}",
                "return_for_revision": "{% trans 'Return for revision' %}",
                "approve": "{% trans 'Approve' %}",
                "delete_confirmation": "{% trans 'Are you sure you want to delete this update?' %}",
                "yes": "{% trans 'Yes' %}",
                "no": "{% trans 'No' %}",
                "add_image": "{% trans 'Add image' %}",
                "change_image": "{% trans 'Change image' %}",
                "attach_file": "{% trans 'Attach file' %}",
                "unknown_date": "{% trans 'Unknown date' %}",
                "comment": "{% trans 'Comment' %}",
                "comments": "{% trans 'Comments' %}",
                "add_comment": "{% trans 'Add comment' %}",
                "add_comment_placeholder": "{% trans 'Add an internal comment to the update' %}",
                "and": "{% trans 'and' %}",
                "others": "{% trans 'others' %}",
                "general_error": "{% trans 'An error occurred' %}",
                "connection_error": "{% trans 'There was a connection error. Please check your internet connection and refresh the page.' %}"
            }
        </script>

    {% endif %}

    {# Slider library #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/8.0.2/nouislider.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/8.0.2/nouislider.min.css" type="text/css">

    {% compressed_js 'project_main' %}

    {% if project.is_impact_project and project.results.all %}
        {% compressed_js 'my_results' %}
    {% endif %}
{% endblock js %}

{% block jq %}
  {{ block.super }}
  $('.logoImg > img').css('margin','inherit');
{% endblock jq %}
