{% extends "myrsr/myrsr_base.html" %}
{% load i18n bootstrap3 rsr_utils %}
{% block title %}{% trans 'MyRSR - Project Admin' %}{% endblock %}
{% block myrsr_main %}
    <h4>{% trans 'Project admin' %}</h4>
    <!--*************************************** FORM Container **********************************************-->

    <div class="formOverviewInfo">
        <div class="editDate">
            <span>Date created:</span>
            <time datetime="YYYY-MM-DDThh:mm:ssTZD">
            {{ project.created_at }}
            </time><br/>
            <span>Date modified:</span>
            <time datetime="YYYY-MM-DDThh:mm:ssTZD">
            {{ project.last_modified_at }}
            </time>
        </div>
        <div class="progress overview">
            <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                <span class="sr-only">40% Complete (success)</span>40%
            </div>
        </div>
    </div>
    <section class="panels projectEdit">
        <fieldset>
                <!--*************************************** FORM STEP 1 **********************************************-->
                <div class="myPanel borderBottom" id="panel1">
                    <div class="formStep stepOne">
                        <label for="stepOne"><h4>01 - General information</h4></label>
                        <input type="radio" name="step" id="stepOne" checked >
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                                <span class="sr-only">30% Complete (success)</span>30%
                            </div>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                                <span class="sr-only">30% Complete (success)</span>30%
                            </div>
                        </div>
                        <div class="formBlock">
                            <form role="form" id="adminstep1" action="javascript: submitstep1()">
                            <div class="form-group control">
                                <input type="text" class="form-control" name="projectTitle" id="projectTitle" placeholder="Project title" value="{% if project.title %}{{project.title}}{% endif %}" maxlength="45" />
                                <label for="projectTitle" class="control-label">Project title</label>
                                <p class="help-block hidden">The title and subtitle fields are the newspaper headline for your project. Use them to attract attention to what you are doing. (45 characters)</p>
                            </div>
                            <div class="form-group control">
                                <input type="text" class="form-control" name="projectSubTitle" id="projectSubTitle" placeholder="Project subtitle" maxlength="75"
                                {% if project.subtitle %} value="{{project.subtitle}}" {% endif %} />
                                <label for="projectSubTitle" class="control-label">Project subtitle</label>
                                <p class="help-block hidden">The title and subtitle fields are the newspaper headline for your project. Use them to attract attention to what you are doing. (75 characters)</p>
                            </div>
                            <div class="form-group control">
                                <input type="text" class="form-control" name="iatiId" id="iatiID" placeholder="iati ID" maxlength="100"
                                {% if project.iati_activity_id %} value="{{project.iati_activity_id}}" {% endif %} />
                                <label for="iatiID" class="control-label">IATI identifier</label>
                                <p class="help-block">This should be the official unique IATI Identifier for the project. The identifier consists of the IATI organisation identifier and the (organisations internal) project identifier, e.g. NL-KVK-31156201-TZ1234. (100 characters)<br/>
                                Note that 'projects' in this form are the same as 'activities' in IATI.</p>
                            </div>
                            <div class="related-project-container">
                                {% for rp in project.related_projects.all %}
                                    {% include "myrsr/project_admin_partials/related_project_input.html" with key=rp.pk %}
                                {% empty %}
                                    {% include "myrsr/project_admin_partials/related_project_input.html" with key='add-0' %}
                                {% endfor %}
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-related-project"><span class="glyphicon glyphicon-plus"></span> Add another related project</a>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="projectStatus" id="projectStatus" class="form-control">
                                        <option value="N" {% if project.status == "N" %} selected="selected"{% endif %}>None</option>
                                        <option value="H" {% if project.status == "H" %} selected="selected"{% endif %}>Needs funding</option>
                                        <option value="A" {% if project.status == "A" %} selected="selected"{% endif %}>Active</option>
                                        <option value="C" {% if project.status == "C" %} selected="selected"{% endif %}>Complete</option>
                                        <option value="L" {% if project.status == "L" %} selected="selected"{% endif %}>Cancelled</option>
                                        <option value="R" {% if project.status == "R" %} selected="selected"{% endif %}>Archived</option>
                                    </select>
                                    <label for="projectStatus" class="control-label">Status</label>
                                </div>
                                <p class="help-block">
                                There are four different project statuses:</p>
                                <ol class="help-block">
                                    <li>Needs funding: projects that still need funding.</li>
                                    <li>Active: projects that started with the implementation phase.</li>
                                    <li>Completed: projects that have been finished.</li>
                                    <li>Cancelled: projects that were never fully implemented or carried out.</li>
                                </ol>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 control">
                                        <input type="date" class="form-control ll-skin-melon" name="eventFromPlanned" id="eventFromPlanned" placeholder="From (planned)"
                                        {% if project.date_start_planned %} value="{{project.date_start_planned|date:'c'}}" {% endif %} />
                                        <label for="eventFromPlanned" class="control-label">Start Date (planned):</label>
                                    </div>
                                    <div class="col-md-6 control">
                                        <input type="date" class="form-control" name="eventEndPlanned" id="eventEndPlanned" placeholder="To (planned)"
                                        {% if project.date_end_planned %} value="{{project.date_end_planned|date:'c'}}" {% endif %} />
                                        <label for="eventEndPlanned" class="control-label">End Date (planned):</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 control">
                                        <input type="date" class="form-control ll-skin-melon" name="eventFromActual" id="eventFromActual" placeholder="From (Actual)"
                                        {% if project.date_start_actual %} value="{{project.date_start_actual|date:'c'}}" {% endif %} />
                                        <label for="eventFromActual" class="control-label">Start Date (Actual):</label>
                                    </div>
                                    <div class="col-md-6 control">
                                        <input type="date" class="form-control" name="eventEndActual" id="eventEndActual" placeholder="To (Actual)"
                                        {% if project.date_end_actual %} value="{{project.date_end_actual|date:'c'}}" {% endif %} />
                                        <label for="eventEndActual" class="control-label">End Date (Actual):</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="projectLanguage" id="projectLanguage" class="form-control">
                                        <option value="de" {% if project.language == 'de'%} selected="selected" {% endif %}>German</option>
                                        <option value="en" {% if project.language == 'en'%} selected="selected" {% endif %}>English</option>
                                        <option value="fr" {% if project.language == 'fr'%} selected="selected" {% endif %}>French</option>
                                        <option value="es" {% if project.language == 'es'%} selected="selected" {% endif %}>Spanish</option>
                                        <option value="nl" {% if project.language == 'nl'%} selected="selected" {% endif %}>Dutch</option>
                                        <option value="ru" {% if project.language == 'ru'%} selected="selected" {% endif %}>Russian</option>
                                    </select>
                                    <label for="language" class="control-label">Language</label>
                                </div>
                                <p class="help-block">The main language of the project.</p>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="projectCurrency" id="projectCurrency" class="form-control">
                                        <option value="USD" {% if project.currency == "USD"%} selected="selected" {% endif %}>$</option>
                                        <option value="EUR" {% if project.currency == "EUR"%} selected="selected" {% endif %}>€</option>
                                    </select>
                                    <label for="projectCurrency" class="control-label">Currency</label>
                                </div>
                                <p class="help-block hidden">The default currency for this project. Used in all financial aspects of the project.</p>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="projectHierarchy" id="projectHierarchy" class="form-control">
                                        <option value="" {% if not project.hierarchy %} selected="selected" {% endif %}>Hierarchy:</option>
                                        <option value="1" {% if project.hierarchy|add:0 == 1 %} selected="selected" {% endif %}>Core activity</option>
                                        <option value="2" {% if project.hierarchy|add:0 == 2 %} selected="selected" {% endif %}>Sub activity</option>
                                        <option value="3" {% if project.hierarchy|add:0 == 3 %} selected="selected" {% endif %}>Lower sub activity</option>
                                    </select>
                                    <label for="projectHierarchy" class="control-label">Hierarchy</label>
                                </div>
                                <p class="help-block">If you are reporting multiple levels of projects in RSR, you can specify whether this is a core or sub-project here.<br/>
                                So for example: is this project part of a larger project or programme.</p>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="defaultAidType" id="defaultAidType" class="form-control"> 
                                        <option value="" {% if not project.default_aid_type %} selected="selected" {% endif %}>Default aid type:</option>                                      
                                        {% for entry in aid_types %}
                                            {% if not entry.0 == "code" %}
                                                <option value="{{entry.0}}" {% if project.default_aid_type == entry.0 %} selected="selected" {% endif %}>{{entry.0}} - {{entry.2}}</option>
                                            {% endif %}
                                        {% endfor %} 
                                    </select>
                                    <label for="defaultAidType" class="control-label">Default aid type</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="defaultFlowType" id="defaultFlowType" class="form-control">
                                        <option value="" {% if not project.default_flow_type %} selected="selected" {% endif %}>Default flow type:</option>
                                        {% for entry in flow_types %}
                                            {% if not entry.0 == "code" %}
                                                <option value="{{entry.0}}" {% if project.default_flow_type == entry.0 %} selected="selected" {% endif %}>{{entry.0}} - {{entry.1}}</option>
                                            {% endif %}
                                        {% endfor %} 
                                    </select>
                                    <label for="defaultFlowType" class="control-label">Default flow type</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="defaultTiedStatus" id="defaultTiedStatus" class="form-control">
                                        <option value="" {% if not project.default_tied_status %} selected="selected" {% endif %}>Default tied status:</option>
                                        {% for entry in tied_status %}
                                            {% if not entry.0 == "code" %}
                                                <option value="{{entry.0}}" {% if project.default_tied_status == entry.0 %} selected="selected" {% endif %}>{{entry.0}} - {{entry.1}}</option>
                                            {% endif %}
                                        {% endfor %} 
                                    </select>
                                    <label for="defaultTiedStatus" class="control-label">Default flow type</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="collaborationType" id="collaborationType" class="form-control">
                                        <option value="" {% if not project.collaboration_type %} selected="selected" {% endif %}>Collaboration type:</option>
                                        {% for entry in collaboration_type %}
                                            {% if not entry.0 == "code" %}
                                                <option value="{{entry.0}}" {% if project.collaboration_type == entry.0 %} selected="selected" {% endif %}>{{entry.0}} - {{entry.1}}</option>
                                            {% endif %}
                                        {% endfor %} 
                                    </select>
                                    <label for="collaborationType" class="control-label">Collaboration type</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="defaultFinanceType" id="defaultFinanceType" class="form-control">
                                        <option value="" {% if not project.default_finance_type %} selected="selected" {% endif %}>Default finance type:</option>
                                        {% for entry in finance_type %}
                                            {% if not entry.0 == "code" %}
                                                <option value="{{entry.0}}" {% if project.default_finance_type == entry.0 %} selected="selected" {% endif %}>{{entry.0}} - {{entry.2}}</option>
                                            {% endif %}
                                        {% endfor %} 
                                    </select>
                                    <label for="defaultFinanceType" class="control-label">Default finance type</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                    <input type="submit" class="btn btn-info" value="Save">
                                </div>
                                <div id="savingstep1"></div>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 2 **********************************************-->
                <div class="myPanel borderBottom" id="panel2">
                    <div class="formStep stepTwo">
                        <label for="stepTwo"><h4>02 - Contact information</h4></label>
                        <input type="radio" name="step" id="stepTwo">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <span class="sr-only">0% Complete (success)</span>0%
                            </div>
                        </div>  
                        <div class="formBlock">
                            <div class="contact-information-container">
                                {% if project.contacts.all %}
                                    {% for contact in project.contacts.all %}
                                        {% include "myrsr/project_admin_partials/contact_information_input.html" %}
                                    {% endfor %}
                                {% else %}
                                        {% include "myrsr/project_admin_partials/contact_information_input.html" %}
                                {% endif %}
                            </div> 
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-contact-information"><span class="glyphicon glyphicon-plus"></span> Add another contact</a>
                                </div>
                            </div>                             
                        </div>                                    
                    </div>
                </div>
                <!--*************************************** FORM STEP 3 **********************************************-->
                <div class="myPanel borderBottom" id="panel3">
                    <div class="formStep stepThree">
                        <label for="stepThree"><h4>03 - Partners</h4></label>
                        <input type="radio" name="step" id="stepThree">                        
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
                                <span class="sr-only">10% Complete (success)</span>10%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="form-group control">
                                <select class="form-control" id="reportingOrganisation" placeholder="Reporting organisation"
                                name="reportinOrganisation">
                                    <option {% if not project.reporting_org %} selected="selected" {% endif %}>                                       
                                        Reporting organisation:
                                    </option>
                                    {% for org in organisation %}
                                        <option value="{{org.id}}" 
                                        {% if project.reporting_org.name == org.name %} selected="selected" {% endif %}>
                                            {{org.name}}
                                        </option>
                                    {% endfor %}
                                </select>
                                <label for="reportingOrganisation" class="control-label">Reporting organisation</label>
                            </div>
                            <div class="form-group control">
                                <div class="checkbox">
                                    <label for="secondaryReporter" class="control-label">
                                        <input id="secondaryReporter" type="checkbox" name="secondaryReporter"
                                        {% if project.sync_owner_secondary_reporter %} checked {% endif %}>
                                            Secondary reporter
                                        </label>
                                </div>
                                <p class="help-block hidden">This indicates whether the reporting organisation is a secondary publisher: publishing data for which it is not directly responsible.</p>
                            </div>
                            <hr/>
                            <div class="partner-container">
                                {% if project.partnerships.all %}
                                    {% for partnership in project.partnerships.all %}
                                        {% include "myrsr/project_admin_partials/partner_input.html" %}
                                    {% endfor %}
                                {% else %}
                                        {% include "myrsr/project_admin_partials/partner_input.html" %}
                                {% endif %}    
                            </div>                         
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-partner"><span class="glyphicon glyphicon-plus"></span> Add another partner</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 4 **********************************************-->
                <div class="myPanel borderBottom" id="panel4">
                    <div class="formStep stepFour">
                        <label for="stepFour"><h4>04 - Descriptions</h4></label>
                        <input type="radio" name="step" id="stepFour">                        
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                <span class="sr-only">20% Complete (success)</span>20%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="form-group control">
                                <textarea id="summary" class="form-control" name="projectPlanSummary" placeholder="Type in summary of the project plan">{% if project.project_plan_summary %}{{project.project_plan_summary}}{% endif %}</textarea>
                                <label class="control-label" for="summary">Summary of project plan</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="background" class="form-control" name="textarea" placeholder="Type in background">{% if project.background %}{{project.background}}{% endif %}</textarea>
                                <label class="control-label" for="background">Background</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="currentSituation" class="form-control" name="textarea" placeholder="Type in current situation">{% if project.current_status %}{{project.current_status}}{% endif %}</textarea>
                                <label class="control-label" for="currentSituation">Current situation</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="projectPlan" class="form-control" name="textarea" placeholder="Type in project plan">{% if project.project_plan %}{{project.project_plan}}{% endif %}</textarea>
                                <label class="control-label" for="projectPlan">Project plan</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="targetGroup" class="form-control" name="textarea" placeholder="Type in target group">{% if project.target_group %}{{project.target_group}}{% endif %}</textarea>
                                <label class="control-label" for="targetGroup">Target group</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="sustainability" class="form-control" name="textarea" placeholder="Type in sustainability">{% if project.sustainability %}{{project.sustainability}}{% endif %}</textarea>
                                <label class="control-label" for="sustainability">Sustainability</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="goalsOverview" class="form-control" name="textarea" placeholder="Type in goals overview">{% if project.goals_overview %}{{project.goals_overview}}{% endif %}</textarea>
                                <label class="control-label" for="goalsOverview">Goals overview</label>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 5 **********************************************-->
                <div class="myPanel borderBottom" id="panel5">
                    <div class="formStep stepFive">
                        <label for="stepFive"><h4>05 - Photo</h4></label>
                        <input type="radio" name="step" id="stepFive">                        
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                <span class="sr-only">30% Complete (success)</span>40%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="form-group control">
                                {% if project.current_image %}
                                    <img src="{{project.current_image.url}}" class="current-project-photo">
                                {% endif %}
                                <input type="file" class="form-control" id="photo">
                                <label class="control-label" for="photo">Photo</label>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 control">
                                        <input type="text" class="form-control" id="photoCaption" placeholder="Photo caption"
                                        {% if project.current_image_caption %} value="{{project.current_image_caption}}" {% endif %}>
                                        <label for="photoCaption" class="control-label">Photo caption</label>
                                    </div>
                                    <div class="col-md-6 control">
                                        <input type="text" class="form-control" id="photoCredit" placeholder="Photo credit"
                                        {% if project.current_image_credit %} value="{{project.current_image_credit}}" {% endif %}>
                                        <label for="photoCredit" class="control-label">Photo credit</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 6 **********************************************-->
                <div class="myPanel borderBottom" id="panel6">
                    <div class="formStep stepSix">
                        <label for="stepSix"><h4>06 - Links and documents</h4></label>
                        <input type="radio" name="step" id="stepSix">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                <span class="sr-only">60% Complete (success)</span>60%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="form-group">
                                <div class="link-container">
                                    {% if project.links.all %}
                                        {% for link in project.links.all %}
                                            {% include "myrsr/project_admin_partials/link_input.html" %}
                                        {% endfor %}
                                    {% else %}
                                        {% include "myrsr/project_admin_partials/link_input.html" %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-link"><span class="glyphicon glyphicon-plus"></span> Add another link</a>
                                </div>
                            </div>
                                <div class="document-container">
                                    {% if project.documents.all %}
                                        {% for document in project.documents.all %}
                                            {% include "myrsr/project_admin_partials/document_input.html" %}
                                        {% endfor %}
                                    {% else %}
                                        {% include "myrsr/project_admin_partials/document_input.html" %}
                                    {% endif %}   
                                </div>                         
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-document"><span class="glyphicon glyphicon-plus"></span> Add another document</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 7 **********************************************-->
                <div class="myPanel borderBottom" id="panel7">
                    <div class="formStep stepSeven">
                        <label for="stepSeven"><h4>07 - Locations</h4></label>
                        <input type="radio" name="step" id="stepSeven">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                                <span class="sr-only">30% Complete (success)</span>30%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="scope" id="scope" class="form-control">
                                        <option value="" {% if not project.project_scope %} selected="selected" {% endif %}>
                                            Project scope
                                        </option>
                                        {% for scope in activity_scope %}
                                            {% if not scope.0 == "code" %}
                                                <option value="{{scope.0}}" {% if project.project_scope == scope.0 %} selected="selected" {% endif %}>
                                                    {{scope.0}} - {{scope.1}}
                                                </option>
                                            {% endif %}
                                        {% endfor %}                                        
                                    </select>
                                    <label for="scope" class="control-label">Project scope</label>
                                </div>
                            </div>
                            <hr/>    
                            <div class="recipient-country-container">   
                                {% if project.recipient_countries.all %}
                                    {% for rc in project.recipient_countries.all %}
                                        {% include "myrsr/project_admin_partials/recipient_country_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/recipient_country_input.html" %}
                                {% endif %} 
                            </div> 
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-recipient-country"><span class="glyphicon glyphicon-plus"></span> Add another recipient country</a>
                                </div>
                            </div>
                            <hr/> 
                            <div class="recipient-region-container">
                                {% if project.recipient_regions.all %}
                                    {% for rr in project.recipient_regions.all %}
                                        {% include "myrsr/project_admin_partials/recipient_region_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/recipient_region_input.html" %}
                                {% endif %}
                            </div>                             
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-recipient-region"><span class="glyphicon glyphicon-plus"></span> Add another recipient region</a>
                                </div>
                            </div>
                            <hr/>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6 control">
                                        <input type="text" class="form-control" id="latitude" placeholder="Latitude"
                                        {% if project.primary_location.latitude %} value="{{project.primary_location.latitude}}" {% endif %}>
                                        <label class="control-label" for="latitude">Latitude</label>
                                    </div>
                                    <div class="col-md-6 control">
                                        <input type="text" class="form-control" id="longitude" placeholder="Longitude"
                                        {% if project.primary_location.longitude %} value="{{project.primary_location.longitude}}" {% endif %}>
                                        <label class="control-label" for="longitude">Longitude</label>
                                    </div>
                                </div>
                            </div>
                            {{country.code}}
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="partnerType" id="country" class="form-control">
                                        <option value="" {% if not project.primary_location.country %} selected="selected" {% endif %}>Country:</option>
                                        {% for country in country %}
                                            <option value="{{country.code}}"
                                            {% if project.primary_location.country == country %} selected="selected" {% endif %}>
                                                {{country.name}}
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <label for="scope" class="control-label">Country</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="city" placeholder="City"
                                        {% if project.primary_location.city %} value="{{project.primary_location.city}}" {% endif %}>
                                        <label class="control-label" for="city">City</label>
                                    </div>
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="postalCode" placeholder="Postal code"
                                        {% if project.primary_location.postcode %} value="{{project.primary_location.postcode}}" {% endif %}>
                                        <label class="control-label" for="postalCode">Postal code</label>
                                    </div>
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="state" placeholder="State"
                                        {% if project.primary_location.state %} value="{{project.primary_location.state}}" {% endif %}>
                                        <label class="control-label" for="state">State</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group control">
                                <input type="text" class="form-control" id="address1" placeholder="Address 1"
                                {% if project.primary_location.address_1 %} value="{{project.primary_location.address_1}}" {% endif %}>
                                <label class="control-label" for="address1">Address 1</label>
                            </div>
                            <div class="form-group control">
                                <input type="text" class="form-control" id="address2" placeholder="Address 2"
                                {% if project.primary_location.address_2 %} value="{{project.primary_location.address_2}}" {% endif %}>
                                <label class="control-label" for="address2">Address 2</label>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="locationReference" placeholder="Reference"
                                        {% if project.primary_location.reference %} value="{{project.primary_location.reference}}" {% endif %}>
                                        <label class="control-label" for="locationReference">Reference</label>
                                    </div>
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="locationCode" placeholder="Code"
                                        {% if project.primary_location.location_code %} value="{{project.primary_location.location_code}}" {% endif %}>
                                        <label class="control-label" for="locationCode">Code</label>
                                    </div>
                                    <div class="col-md-4 control">
                                        <input type="text" class="form-control" id="locationName" placeholder="Name"
                                        {% if project.primary_location.name %} value="{{project.primary_location.name}}" {% endif %}>
                                        <label class="control-label" for="locationName">Name</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group control">
                                <textarea id="locationDescription" class="form-control" name="textarea" placeholder="Type in a location description">{{project.primary_location.description}}</textarea>
                                <label class="control-label" for="locationDescription">Description</label>
                            </div>
                            <div class="form-group control">
                                <textarea id="locationActivityDescription" class="form-control" name="textarea" placeholder="Type in a location activity description">{{project.primary_location.activity_description}}</textarea>
                                <label class="control-label" for="locationActivityDescription">Activity description</label>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="select-group control">
                                            <select name="partnerType" id="locationExactness" class="form-control">
                                                <option value="" {% if not project.primary_location.exactness %} selected="selected" {% endif %}>
                                                    Exactness:
                                                </option>
                                                {% for ge in geographic_exactness %}
                                                    {% if not ge.0 == "code" %}
                                                       <option value="{{ge.0}}" 
                                                       {% if project.primary_location.exactness == ge.0 %} selected="selected" {% endif %}>
                                                            {{ge.0}} - {{ge.1}}
                                                        </option> 
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                            <label class="control-label" for="locationExactness">Exactness</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="select-group control">
                                            <select name="partnerType" id="locationReach" class="form-control">
                                                <option value="" {% if not project.primary_location.location_reach %} selected="selected" {% endif %}>
                                                    Reach:
                                                </option>
                                                {% for glr in geographic_location_reach%}
                                                    {% if not glr.0 == "code" %}
                                                       <option value="{{glr.0}}"
                                                       {% if project.primary_location.location_reach == glr.0 %} selected="selected" {% endif %}>
                                                            {{glr.0}} - {{glr.1}}
                                                        </option> 
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                            <label class="control-label" for="locationReach">Reach</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="select-group control">
                                            <select name="partnerType" id="locationClass" class="form-control">
                                                <option value="" selected="selected">Class</option>
                                                {% for glc in geographic_location_class%}
                                                    {% if not glc.0 == "code" %}
                                                       <option value="{{glr.0}}"
                                                       {% if project.primary_location.location_class == glc.0 %} selected="selected" {% endif %}>
                                                            {{glc.0}} - {{glc.1}}
                                                        </option> 
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                            <label class="control-label" for="locationClass">Class</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="select-group control">
                                            <select name="partnerType" id="locationFeatureDesignation" class="form-control">
                                                <option value="" selected="selected">Feature designation</option>
                                                {% for gfd in location_type %}
                                                    {% if not gfd.0 == "code" %}
                                                       <option value="{{glr.0}}"
                                                       {% if project.primary_location.feature_designation == gfd.0 %} selected="selected" {% endif %}>
                                                            {{gfd.0}} - {{gfd.1}}
                                                        </option> 
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                            <label class="control-label" for="locationFeatureDesignation">Feature designation</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="location-adminstrative-container">
                                {% if project.primary_location.administratives.all %}
                                    {% for admin in project.primary_location.administratives.all %}
                                        {% include "myrsr/project_admin_partials/location_adminstrative_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/location_adminstrative_input.html" %}
                                {% endif %}
                            </div>    
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-location-adminstrative"><span class="glyphicon glyphicon-plus"></span> Add another location</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 8 **********************************************-->
                <div class="myPanel borderBottom" id="panel8">
                    <div class="formStep stepEight">
                        <label for="stepEight"><h4>08 - Focus</h4></label>
                        <input type="radio" name="step" id="stepEight">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                                <span class="sr-only">30% Complete (success)</span>30%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="sector-container">
                                {% if project.sectors.all %}
                                    {% for sector in project.sectors.all %}
                                        {% include "myrsr/project_admin_partials/sector_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/sector_input.html" %}
                                {% endif %}
                            </div>    
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-sector"><span class="glyphicon glyphicon-plus"></span> Add another sector</a>
                                </div>
                            </div>
                            <div class="policy-marker-container">
                                {% if project.policy_markers.all %}
                                    {% for marker in project.policy_markers.all %}
                                        {% include "myrsr/project_admin_partials/policy_marker_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/policy_marker_input.html" %}
                                {% endif %}
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-policy-marker"> <span class="glyphicon glyphicon-plus"></span> Add another policy marker</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 9 **********************************************-->
                <div class="myPanel borderBottom" id="panel9">
                    <div class="formStep stepNine">
                        <label for="stepNine"><h4>09 - Finance</h4></label>
                        <input type="radio" name="step" id="stepNine">                        
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%">
                                <span class="sr-only">70% Complete (success)</span>70%
                            </div>
                        </div>
                        <div class="formBlock"> 
                            <div class="form-group control">
                                <input type="number" class="form-control" id="capitalSpendPercentage" placeholder="Capital spend percentage"
                                {% if project.capital_spend_percentage %} value="{{project.capital_spend_percentage}}" {% endif %}>
                                <label for="capitalSpendPercentage" class="control-label">Capital spend percentage</label>
                            </div>
                            <div class="form-group">
                                <div class="select-group control">
                                    <select name="countryBudgetVocabulary" id="countryBudgetVocabulary" class="form-control">
                                        <option value="" {% if not project.country_budget_vocabulary %} selected="selected" {% endif %}>
                                            Country budget vocabulary
                                        </option>
                                        {% for cbv in country_budget_vocabulary %}
                                            {% if not cbv.0 == "code" %}
                                               <option value="{{cbv.0}}"
                                               {% if project.country_budget_vocabulary == cbv.0 %} selected="selected" {% endif %}>
                                                    {{cbv.0}} - {{cbv.1}}
                                                </option> 
                                            {% endif %}
                                        {% endfor %}                                        
                                    </select>
                                    <label for="countryBudgetVocabulary" class="control-label">Country budget vocabulary</label>
                                </div>
                            </div>
                            <hr/>
                            <div class="budget-item-container">
                                {% if project.budget_items.all %}
                                    {% for item in project.budget_items.all %}
                                        {% include "myrsr/project_admin_partials/budget_item_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/budget_item_input.html" %}
                                {% endif %} 
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-budget-item"><span class="glyphicon glyphicon-plus"></span> Add another budget item</a>
                                </div>
                            </div>
                            <hr>
                            <div class="country-budget-item-container">
                                {% if project.country_budget_items.all %}
                                    {% for item in project.country_budget_items.all %}
                                        {% include "myrsr/project_admin_partials/country_budget_item_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/country_budget_item_input.html" %}
                                {% endif %}  
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-country-budget-item"><span class="glyphicon glyphicon-plus"></span> Add another country budget item</a>
                                </div>
                            </div>
                            <hr>
                            <div class="transaction-container">
                                {% if project.transactions.all %}
                                    {% for transaction in project.transactions.all %}
                                        {% include "myrsr/project_admin_partials/transaction_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/transaction_input.html" %}
                                {% endif %}
                            </div>                             
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-transaction"><span class="glyphicon glyphicon-plus"></span> Add another transaction</a>
                                </div>
                            </div>
                            <div class="planned-disbursement-container">
                                {% if project.planned_disbursements.all %}
                                    {% for pd in project.planned_disbursements.all %}
                                        {% include "myrsr/project_admin_partials/planned_disbursement_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/planned_disbursement_input.html" %}
                                {% endif %} 
                            </div>                            
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-planned-disbursement"><span class="glyphicon glyphicon-plus"></span> Add another planned disbursement</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--*************************************** FORM STEP 10 **********************************************-->
                <div class="myPanel borderBottom" id="panel10">
                    <div class="formStep stepTen">
                        <label for="stepTen"><h4>10 - Results</h4></label>
                        <input type="radio" name="step" id="stepTen">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                                <span class="sr-only">30% Complete (success)</span>30%
                            </div>
                        </div>
                        <div class="formBlock">
                            <div class="condition-container">
                                {% if project.conditions.all %}
                                    {% for condition in project.conditions.all %}
                                        {% include "myrsr/project_admin_partials/condition_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/condition_input.html" %}
                                {% endif %} 
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-condition"><span class="glyphicon glyphicon-plus"></span> Add another condition</a>
                                </div>
                            </div>
                            <div class="result-container">
                                {% if project.results.all %}
                                    {% for result in project.results.all %}
                                        {% include "myrsr/project_admin_partials/result_input.html" %}
                                    {% endfor %}
                                {% else %}
                                    {% include "myrsr/project_admin_partials/result_input.html" %}
                                {% endif %}
                            </div>                            
                            <div class="row">
                                <div class="col-md-6 col-md-offset-3 text-center">
                                    <a href="#" class="btn btn-link" id="add-result"><span class="glyphicon glyphicon-plus"></span> Add another result</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </form>
    </section>
{% endblock %}

{% block js %}
    {{ block.super }}

    <script type="text/javascript" src="http://form-serialize.googlecode.com/svn/trunk/serialize-0.2.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.6/zepto.min.js"></script>

    <script type="text/template" id="related-project-input">{% include "myrsr/project_admin_partials/related_project_input.html" %}</script>
    <script type="text/template" id="budget-item-input">{% include "myrsr/project_admin_partials/budget_item_input.html" %}</script>
    <script type="text/template" id="condition-input">{% include "myrsr/project_admin_partials/condition_input.html" %}</script> 
    <script type="text/template" id="contact-information-input">{% include "myrsr/project_admin_partials/contact_information_input.html" %}</script> 
    <script type="text/template" id="country-budget-item-input">{% include "myrsr/project_admin_partials/country_budget_item_input.html" %}</script> 
    <script type="text/template" id="document-input">{% include "myrsr/project_admin_partials/document_input.html" %}</script> 
    <script type="text/template" id="indicator-input">{% include "myrsr/project_admin_partials/indicator_input.html" %}</script> 
    <script type="text/template" id="indicator-period-input">{% include "myrsr/project_admin_partials/indicator_period_input.html" %}</script> 
    <script type="text/template" id="link-input">{% include "myrsr/project_admin_partials/link_input.html" %}</script> 
    <script type="text/template" id="location-adminstrative-input">{% include "myrsr/project_admin_partials/location_adminstrative_input.html"%}</script> 
    <script type="text/template" id="partner-input">{% include "myrsr/project_admin_partials/partner_input.html" %}</script> 
    <script type="text/template" id="planned-disbursement-input">{% include "myrsr/project_admin_partials/planned_disbursement_input.html" %}</script> 
    <script type="text/template" id="policy-marker-input">{% include "myrsr/project_admin_partials/policy_marker_input.html" %}</script> 
    <script type="text/template" id="recipient-country-input">{% include "myrsr/project_admin_partials/recipient_country_input.html" %}</script> 
    <script type="text/template" id="recipient-region-input">{% include "myrsr/project_admin_partials/recipient_region_input.html" %}</script> 
    <script type="text/template" id="related-project-input">{% include "myrsr/project_admin_partials/related_project_input.html" %}</script> 
    <script type="text/template" id="result-input">{% include "myrsr/project_admin_partials/result_input.html" %}</script> 
    <script type="text/template" id="sector-input">{% include "myrsr/project_admin_partials/sector_input.html" %}</script> 
    <script type="text/template" id="transaction-input">{% include "myrsr/project_admin_partials/transaction_input.html" %}</script> 
    <script type="text/template" id="transaction-sector-input">{% include "myrsr/project_admin_partials/transaction_sector_input.html" %}</script>                               

    <script type="application/javascript">
        $(document).ready( function() {

            var partials = ['related-project', 'budget-item', 'condition', 'contact-information', 
                'country-budget-item','document', 'indicator', 'indicator-period', 'link', 'partner', 
                'planned-disbursement', 'policy-marker', 'recipient-country', 'recipient-region', 
                'related-project','result', 'sector', 'transaction', 'transaction-sector'];

            var partialsCount = {};

            // Keep count of how many of each partial we've injected
            for (var i=0; i < partials.length; i++) {
                var partialName = partials[i];

                partialsCount[partialName] = 1;
            }

            for (var i=0; i < partials.length; i++) {
                var pName = partials[i];            
                var buttonSelector = '#add-' + pName;

                document.querySelector(buttonSelector).onclick = getOnClick(pName);

            }

            function getOnClick(pName) {
                var onclick = function(e) {
                    e.preventDefault();

                    var markupSelector = '#' + pName + '-input';
                    var containerSelector = '.' + pName + '-container';

                    var markup = document.querySelector(markupSelector).innerHTML;                

                    var partial = document.createElement('div');
                    partial.innerHTML = markup;

                    $(partial).find('input').each( function() {
                        addCountToName($(this));
                    });

                    $(partial).find('select').each( function() {
                        addCountToName($(this));
                    });

                    $(partial).find('textarea').each( function() {
                        addCountToName($(this));
                    });                                           

                    function addCountToName(el) {
                        var oldName = el.attr('name');
                        var newName = oldName + '-add-' + partialsCount[pName];

                        el.attr('name', newName);

                        var oldID = el.attr('id');
                        var newID = oldID + '-add-' + partialsCount[pName];

                        el.attr('id', newID);                        
                    }

                    document.querySelector(containerSelector).appendChild(partial);  
                    partialsCount[pName] += 1;                  
                };

                return onclick;
            }  
        });       
    </script>   

    <script type="application/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function savingStep(saving, step) {
            var div, div_id;

            div_id = '#savingstep' + step;
            div = document.querySelector(div_id);

            if (saving) {
                div.innerHTML = 'Saving...';
            } else {
                div.innerHTML = '';
            }
        }

        function removeErrors(form) {
            var error_elements, form_elements;

            error_elements = form.getElementsByClassName('error');
            form_elements = form.getElementsByClassName('has-error');

            while(error_elements.length > 0){
                error_elements[0].parentNode.removeChild(error_elements[0]);
            }

            for (var j = 0; j < form_elements.length; j++) {
                form_elements[j].className =
                        form_elements[j].className.replace( /(?:^|\s)has-error(?!\S)/g , '' );
            }
        }

        function addErrors(errors) {
            for (var i = 0; i < errors.length; i++) {
                var error, form_group, labels, span, textnode;

                error = errors[i];
                form_group = document.querySelector('#' + error.name).parentNode;
                form_group.className += ' has-error';

                labels = form_group.getElementsByTagName('label');
                span = document.createElement("span");
                textnode = document.createTextNode(' (' + error.error + ')');
                span.appendChild(textnode);
                span.className = 'error';
                labels[0].appendChild(span);

                if (i === 0) {
                    document.getElementById(error.name).scrollIntoView();
                    window.scrollBy(0, -100);
                }
            }
        }

        function submitstep1() {
            savingStep(true, 1);

            var form, form_data, request;

            // Collect form data
            form = document.querySelector('#adminstep1');
            form_data = serialize(form);
            form_data += '&eventFromPlanned=' + document.querySelector('#eventFromPlanned').value;
            form_data += '&eventFromActual=' + document.querySelector('#eventFromActual').value;
            form_data += '&eventEndPlanned=' + document.querySelector('#eventEndPlanned').value;
            form_data += '&eventEndActual=' + document.querySelector('#eventEndActual').value;

            // Create request
            request = new XMLHttpRequest();
            request.open('POST', '{% url 'project_admin_step1' project.pk %}?format=json', true);
            request.setRequestHeader("X-CSRFToken", csrftoken);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            request.onload = function() {
                if (request.status >= 200 && request.status < 400) {
                    var response;

                    removeErrors(form);
                    response = JSON.parse(request.responseText);
                    addErrors(response.errors);

                    savingStep(false, 1);
                    return false;
                } else {
                    // We reached our target server, but it returned an error
                    savingStep(false, 1);
                    return false;
                }
            };

            request.onerror = function() {
                // There was a connection error of some sort
                savingStep(false, 1);
                return false;
            };

            request.send(form_data);
        }
    </script>
    
{% endblock %}