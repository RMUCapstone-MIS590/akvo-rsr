{% extends "myrsr/myrsr_base.html" %}

{% load compressed i18n rsr_utils rsr_tags rules rsr_filters humanize markup_tags %}

{% block title %}{% trans 'MyRSR - My Results' %}{% endblock %}

{% block myrsr_main %}
    <h4 class="resultProjectTitle"><span>{% trans 'Project' %}:</span> <a href="{% url 'project-main' project.pk %}">{{ project.title }}</a></h4>
    {% if not project.is_impact_project %}
        <div id="draft" class="row">{% trans 'This is not an RSR Impact project, it is not possible to place updates on this project.' %}</div>
    {% elif not project.results.all %}
        <div id="draft" class="row">{% trans 'This project has no results.' %}</div>
    {% else %}
        {% if not me_managers %}
            <div id="draft" class="row">{% trans 'There are no M&E managers for this project. No one will be able to approve data updates.' %}</div>
        {% endif %}
        <div id="results-framework"></div>
    {% endif %}
{% endblock %}

{% block js %}
    {{ block.super }}

    {# React #}
    <script src="https://fb.me/react-0.14.5.js"></script>
    <script src="https://fb.me/react-dom-0.14.5.js"></script>

    {# Initial data endpoints #}
    <script type="application/json" id="data-endpoints">
        {
            "base_url": "http://{{ request.META.HTTP_HOST }}",
            "results_of_project": "/rest/v1/result/?format=json&project={{ project.pk }}",
            "indicator": "/rest/v1/indicator/{indicator}/?format=json",
            "indicators": "/rest/v1/indicator/?format=json",
            "indicators_of_project": "/rest/v1/indicator/?format=json&result__project={{ project.pk }}",
            "period": "/rest/v1/indicator_period/{period}/?format=json",
            "periods": "/rest/v1/indicator_period/?format=json",
            "periods_of_project": "/rest/v1/indicator_period/?format=json&indicator__result__project={{ project.pk }}",
            "update": "/rest/v1/indicator_period_data/{update}/?format=json",
            "updates": "/rest/v1/indicator_period_data/?format=json",
            "updates_and_comments_of_project": "/rest/v1/indicator_period_data_framework/?format=json&period__indicator__result__project={{ project.pk }}",
            "comment": "/rest/v1/indicator_period_data_comment/{comment}/?format=json",
            "comments": "/rest/v1/indicator_period_data_comment/?format=json",
            "comments_of_project": "/rest/v1/indicator_period_data_comment/?format=json&data__period__indicator__result__project={{ project.pk }}",
            "user": "/rest/v1/user/{{ user.pk }}/?format=json",
            "partnerships": "/rest/v1/partnership/?format=json&project={{ project.pk }}",
            "file_upload": "/rest/v1/indicator_period_data/{update}/upload_file/?format=json"
        }
    </script>

    {# Initial settings #}
    <script type="application/json" id="initial-settings">
        {
            "is_admin": {{ is_admin|yesno:"true,false" }},
            "update_timeout": {{ update_timeout }},
            "current_datetime": "{{ current_datetime|date:"c" }}"
        }
    </script>

    {# Translation strings #}
    <script type="application/json" id="translation-texts">
        {
            "results": "{% trans 'Results' %}",
            "indicator": "{% trans 'Indicator' %}",
            "indicators": "{% trans 'Indicators' %}",
            "indicator_period": "{% trans 'Indicator period' %}",
            "indicator_periods": "{% trans 'Indicator periods' %}",
            "unit": "{% trans 'Unit' %}",
            "percentage": "{% trans 'Percentage' %}",
            "baseline_year": "{% trans 'Baseline year' %}",
            "baseline_value": "{% trans 'Baseline value' %}",
            "period": "{% trans 'Period' %}",
            "loading": "{% trans 'Loading' %}",
            "lock_period": "{% trans 'Lock period' %}",
            "unlock_period": "{% trans 'Unlock period' %}",
            "period_locked": "{% trans 'Period locked' %}",
            "request_update": "{% trans 'Request update' %}",
            "new_actual_value": "{% trans 'New actual value' %}",
            "actual_value": "{% trans 'Actual value' %}",
            "target_value": "{% trans 'Target value' %}",
            "current": "{% trans 'Current' %}",
            "relative_data": "{% trans 'Data is relative to actual value' %}",
            "note": "{% trans 'Note' %}",
            "update": "{% trans 'Update' %}",
            "updates": "{% trans 'Updates' %}",
            "new_update": "{% trans 'New update' %}",
            "adding_update": "{% trans 'Adding new update' %}",
            "edit_update": "{% trans 'Edit update' %}",
            "cancel": "{% trans 'Cancel' %}",
            "save": "{% trans 'Save' %}",
            "submit_for_approval": "{% trans 'Submit for approval' %}",
            "return_for_revision": "{% trans 'Return for revision' %}",
            "approve": "{% trans 'Approve' %}",
            "add_image": "{% trans 'Add image' %}",
            "change_image": "{% trans 'Change image' %}",
            "attach_file": "{% trans 'Attach file' %}",
            "unknown_date": "{% trans 'Unknown date' %}",
            "comment": "{% trans 'Comment' %}",
            "comments": "{% trans 'Comments' %}",
            "add_comment": "{% trans 'Add comment' %}",
            "add_comment_placeholder": "{% trans 'Add an internal comment to the update' %}",
            "general_error": "{% trans 'An error occurred' %}",
            "connection_error": "{% trans 'There was a connection error. Please check your internet connection and refresh the page.' %}"
        }
    </script>

    {% if project.is_impact_project and project.results.all %}
        {% compressed_js 'results_data' %}
    {% endif %}

{% endblock %}