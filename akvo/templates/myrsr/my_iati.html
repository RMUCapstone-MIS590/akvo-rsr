{% extends "myrsr/myrsr_base.html" %}

{% load compressed i18n bootstrap3 %}

{% block title %}{% trans 'MyRSR - My IATI' %}{% endblock title %}

{% block myrsr_main %}
    <h3>
        {% trans "My IATI" %}{% if selected_org %} {% trans "for" %} {{ selected_org.long_name }}{% endif %}
    </h3>
    {% if selected_org and not new_export %}
        <button class="btn btn-default btn-sm" id="createIATIExport">
            <i class="fa fa-plus"></i> {% trans 'Add a new IATI export' %}
        </button>
    {% endif %}
    <div class="IatiDescription topMargin">
        {% blocktrans %}
            IATI stands for <a href="http://www.aidtransparency.net/" target="_blank">International Aid Transparency Initiative</a>,
            which is a global reporting standard that makes it possible to compare and compile data sets from different projects and
            organisations. On this page it is possible to view previously exported files and to export an IATI file of the projects of
            your organisation.
        {% endblocktrans %}
    </div>
    {% if not selected_org %}
        <h4 class="topMargin">{% trans 'Select an organisation' %}</h4>
        {% trans 'Since your account is connected to multiple organisations, please select an organisation first' %}:
        <p>
            <form method="" action="" id="select_org_form">
                {% for field in select_org_form %}
                    {% bootstrap_field field %}
                {% endfor %}
                {% buttons %}
                    <button type="submit" class="btn btn-primary">
                        {% trans 'Select organisation' %}
                    </button>
                {% endbuttons %}
            </form>
        </p>
    {% elif not new_export %}
        {# Selected an organisation, show the IATI exports overview #}
        {# Container for showing a table with existing IATI exports (React) #}
        <div id="exportsOverview"></div>
    {% else %}
        {# Selected an organisation and creating a new export #}
        {# Container for showing a table with projects (React) #}
        <div id="newIATIExport"></div>
    {% endif %}
{% endblock myrsr_main %}

{% block js %}
    {{ block.super }}

    {# React #}
    <script id="react" src="{{ STATIC_URL }}lib/scripts/react-0.14.7.min.js"></script>
    <script id="react-dom" src="{{ STATIC_URL }}lib/scripts/react-dom-0.14.7.min.js"></script>

    {# Translation strings #}
    <script type="application/json" id="translations">
        {
            "iati_export": "{% trans 'IATI export' %}",
            "iati_exports": "{% trans 'IATI exports' %}",
            "project": "{% trans 'project' %}",
            "projects": "{% trans 'projects' %}",
            "last_exports_1": "{% trans 'the public IATI file for your organisation is always available at this link: ' %}",
            "last_exports_2": "{% trans 'if you already have existing IATI exports, you can select which of the IATI exports should be available at this link.' %}",
            "last_exports_3": "{% trans 'this makes it possible to register only this link in the ' %}",
            "last_exports_4": "{% trans ' and automatically update your IATI file in the IATI registry by updating your IATI file in RSR.' %}",
            "last_exports_url": "http://{{ request.META.HTTP_HOST }}/organisation/{{ selected_org.id }}/iati/",
            "iati_registry": "{% trans 'IATI registry' %}",
            "perform_checks_description_1": "{% trans 'In order to see which of your projects is fully IATI compliant, you can perform checks by clicking the Perform checks button.' %}",
            "perform_checks_description_2": "{% trans 'Projects with all mandatory IATI information filled in will be marked green and projects with missing information will be marked red.' %}",
            "loading": "{% trans 'loading' %}",
            "refreshing": "{% trans 'refreshing' %}",
            "last": "{% trans 'last' %}",
            "view_public_file": "{% trans 'view public file' %}",
            "view_file": "{% trans 'view file' %}",
            "set_public": "{% trans 'set as public file' %}",
            "created_by": "{% trans 'created by' %}",
            "created_at": "{% trans 'created at' %}",
            "iati_version": "{% trans 'IATI version' %}",
            "status": "{% trans 'status' %}",
            "number_of_projects": "{% trans '# of projects' %}",
            "actions": "{% trans 'actions' %}",
            "no_iati_file": "{% trans 'no IATI file' %}",
            "no_projects_1": "{% trans 'Your organisation does not report any projects yet.' %}",
            "no_projects_2": "{% trans 'Set your organisation to reporting organisation of a project to create an IATI file for the project.' %}",
            "no_projects_3": "{% trans 'Go to the projects admin ' %}",
            "here": "{% trans 'here' %}",
            "create_new": "{% trans 'create a new' %}",
            "new": "{% trans 'new' %}",
            "no_exports": "{% trans 'your organisation has no IATI exports yet' %}",
            "id": "{% trans 'ID' %}",
            "title": "{% trans 'title' %}",
            "included_export": "{% trans 'included in last export' %}",
            "iati_checks": "{% trans 'IATI checks' %}",
            "public": "{% trans 'public' %}",
            "private": "{% trans 'private' %}",
            "untitled": "{% trans 'untitled' %}",
            "no_status": "{% trans 'no status' %}",
            "perform_checks": "{% trans 'Perform checks' %}",
            "performing_checks": "{% trans 'Performing checks' %}",
            "warning": "{% trans 'Warning' %}",
            "unknown_date": "{% trans 'Unknown date' %}",
            "and": "{% trans 'and' %}"
        }
    </script>

    {# Initial data endpoints #}
    <script type="application/json" id="endpoints">
        {
            "base_url": "http://{{ request.META.HTTP_HOST }}",
            "iati_exports": "/rest/v1/iati_export/?format=json&limit=10&ordering=-created_at&reporting_organisation={{ selected_org.id }}",
            "iati_export": "/rest/v1/iati_export/{iati_export}/?format=json",
            "new_iati_export": "/rest/v1/iati_export/?format=json",
            "reporting_projects": "/rest/v1/project/?format=json&ordering=id&reporting_org={{ selected_org.id }}"
        }
    </script>

    {# Data #}
    <script type="application/json" id="data">
        {
            "user_id": "{{ request.user.id }}",
            "selected_org_id": "{{ selected_org.id }}"
        }
    </script>

    {# Months #}
    <script type="application/json" id="months">
        {
            "january": "{% trans 'Jan' %}",
            "february": "{% trans 'Feb' %}",
            "march": "{% trans 'Mar' %}",
            "april": "{% trans 'Apr' %}",
            "may": "{% trans 'May' %}",
            "june": "{% trans 'Jun' %}",
            "july": "{% trans 'Jul' %}",
            "august": "{% trans 'Aug' %}",
            "september": "{% trans 'Sep' %}",
            "october": "{% trans 'Oct' %}",
            "november": "{% trans 'Nov' %}",
            "december": "{% trans 'Dec' %}"
        }
    </script>

    {% compressed_js 'my_iati' %}
{% endblock js %}