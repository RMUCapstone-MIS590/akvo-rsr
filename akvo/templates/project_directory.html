{% extends "base.html" %}

{% load i18n rsr_utils thumbnail %}

{% block title %}{% trans 'Projects' %}{% endblock %}

{% block head_js %}
<style>
/* Bootstrap style for typeahead dropdown, to be included in CSS file */

span.twitter-typeahead .tt-dropdown-menu {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  display: none;
  float: left;
  min-width: 160px;
  padding: 5px 0;
  margin: 2px 0 0;
  list-style: none;
  font-size: 14px;
  text-align: left;
  color: #000000;
  background-color: #ffffff;
  border: 1px solid #cccccc;
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 4px;
  -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  background-clip: padding-box;
}
span.twitter-typeahead .tt-suggestion > p {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 1.42857143;
  color: #333333;
  white-space: nowrap;
}
span.twitter-typeahead .tt-suggestion > p:hover,
span.twitter-typeahead .tt-suggestion > p:focus {
  color: #ffffff;
  text-decoration: none;
  outline: 0;
  background-color: #428bca;
}
span.twitter-typeahead .tt-suggestion.tt-cursor {
  color: #ffffff;
  background-color: #428bca;
}
span.twitter-typeahead {
  width: 100%;
}
.input-group span.twitter-typeahead {
  display: block !important;
}
.input-group span.twitter-typeahead .tt-dropdown-menu {
  top: 32px !important;
}
.input-group.input-group-lg span.twitter-typeahead .tt-dropdown-menu {
  top: 44px !important;
}
.input-group.input-group-sm span.twitter-typeahead .tt-dropdown-menu {
  top: 28px !important;
}

</style>

<script type="text/javascript">
 $(document).ready(function() {

var projects = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('title'),
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: {
      url: '/rest/v1/project/?format=json&limit=10000',
      filter: function(response) {
          return response.results;
      }
  }
});

var organisations = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('long_name'),
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: {
      url: '/rest/v1/organisation/?format=json&limit=10000',
      filter: function(response) {
          return response.results;
      }
  }
});

var countries = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: {
      url: '/rest/v1/country/?format=json&limit=10000',
      filter: function(response) {
          return response.results;
      }
  }
});

var focus_area = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: {
      url: '/rest/v1/focus_area/?format=json&limit=10000',
      filter: function(response) {
          return response.results;
      }
  }
});

projects.initialize();
organisations.initialize();
countries.initialize();
focus_area.initialize();

$('#query').typeahead({
  highlight: true
},
{
  name: 'projects',
  displayKey: 'title',
  source: projects.ttAdapter(),
  templates: {
    header: '<h3 class="dd-category">Projects</h3>',
    suggestion: Handlebars.compile('<a href="/projects/\{\{id\}\}/"><p><u>\{\{title\}\}</u></p><p>\{\{subtitle\}\}</p></a>')
  }
},
{
  name: 'organisations',
  displayKey: 'long_name',
  source: organisations.ttAdapter(),
  templates: {
    header: '<h3 class="dd-category">Organisations</h3>'
  }
},
{
  name: 'countries',
  displayKey: 'name',
  source: countries.ttAdapter(),
  templates: {
    header: '<h3 class="dd-category">Countries</h3>'
  }
},
{
  name: 'focus_area',
  displayKey: 'name',
  source: focus_area.ttAdapter(),
  templates: {
    header: '<h3 class="dd-category">Focus area</h3>'
  }
});
});
</script>
{% endblock %}

{% block maincontent %}

<section id="map" class="touch-navbar">

</section>

<section id="search-filter">
    <div id="search">
      <form class="form-inline" role="form">
          <p>{% trans "Refine the project list below by searching by name, organisation or sector" %}</p>
        <div class="input-group">
          <input type="text" id="query" class="form-control" placeholder="{% trans 'Search' %}">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button">{% trans "Update list" %}</button>
          </span>
        </div>
      </form>
    </div>

    <div id="filter" style="background-color: #383334; padding: 20px;">
      <span style="color: #00AD9F; display: inline; text-transform: uppercase;">
        continents</span><br />
      <!-- Split button -->
      <div class="btn-group">
        <button type="button" class="btn">All</button>
        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
          <span class="caret"></span>
          <span class="sr-only">Toggle Dropdown</span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><a href="#">All</a></li>
          <li class="divider"></li>
          <li><a href="#">Africa</a></li>
          <li><a href="#">Antartica</a></li>
          <li><a href="#">Asia</a></li>
          <li><a href="#">Australia</a></li>
          <li><a href="#">Europe</a></li>
          <li><a href="#">North America</a></li>
          <li><a href="#">South America</a></li>
        </ul>
      </div>
    </div>
</section>

<div class="container">

    <div class="row center-text">
        <p>{% blocktrans %}Viewing n of n projects{% endblocktrans %}</p>

        <ul class="pagination">
            <li class="disabled"><a href="#">&laquo;</a></li>
            <li class="active"><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">&raquo;</a></li>
        </ul>
    </div>

    <section class="main-list">
        {% for p in projects %}
        <article class="row">
          <div class="col-sm-2 col-xs-3">
            {% comment %}
                <a href="{% url 'project-main' p.id %}">
                  {# <img src="http://placehold.it/200x200" alt="{{p.title}}"> #}
                  {# <img src="/media/{{p.current_image}}" alt="{{p.title}}" /> #}
                  {% thumbnail p.current_image 200x200 upscale autocrop sharpen as project_image %}
                  {# <img src="{{project_image}}" alt="{{p.title" />
                  {% include "partials/img.html" with img=p.current_image size=200x200 title=p.title %}
                </a>
                {# include "partials/img.html" with img=p.current_image size=200x200 title=p.title #}
                {% img p 200 200 p.title %}
                <img src="/media/{{p.current_image}}" alt="" />
                            {% thumbnail p.current_image "200x200" crop="center" as im %}
                <img src="{{ im.url }}" width="{{img.width}}" height="{{im.height}}" />
            {% endthumbnail %}
            {% endcomment %}
            <a href="{% url 'project-main' p.id %}">
              {% img p 200 200 p.title %}
            </a>


            </div>
            <div class="col-sm-4 col-xs-9">
                <h1><a href="{% url 'project-main' p.id %}">{{p.title}}</a></h1>
                <p>{{p.subtitle}}</p>
                <p><span class="glyphicon glyphicon-globe"></span> {{p.primary_location.country}}, {{p.primary_location.country.continent}}</p>
                <p><span class="glyphicon glyphicon-folder-close"></span> <a href="{% url 'organisation-main' p.partners.all.0.id %}">{{p.partners.all.0}}</a> <a href="#" class="small">+{{p.partners.count|add:"-1"}} more</a></p>
            </div>
            <div class="col-sm-3 hidden-xs">
                <h4 class="section">Focus Areas</h4>
                <p><a href="#">Water and sanitation</a></p>

                <h4 class="section">Sectors</h4>
                <p>Education <a href="#" class="small">+4 more</a></p>

                <h4 class="section">Status</h4>
                <p>{{p.get_status_display}}</p>
            </div>
            <div class="col-sm-3 hidden-xs">
                <h4 class="section">Finance</h4>
                {% include "partials/project_budget.html" with project=p %}
            </div>
            <div class="col-xs-9 visible-xs-block">
                <p class="small">
                    <span class="section">Focus Areas</span> <a href="#">Water and sanitation</a><br>
                    <span class="section">Sectors</span> Education <a href="#" class="small">+4 more</a><br>
                    <span class="section">Status</span> {{p.get_status_display}}<br>
                    <span class="section">Finance</span> 26% of $30,000 raised
                </p>
            </div>
        </article>
        {% endfor %}
    </section>

    <div class="row center-text">
        <ul class="pagination">
            <li class="disabled"><a href="#">&laquo;</a></li>
            <li class="active"><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">&raquo;</a></li>
        </ul>
    </div>
</div>
{% endblock %}
