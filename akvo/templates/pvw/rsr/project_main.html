{% extends "rsr/project_base.html" %}
{% load i18n rsr_tags rsr_filters %}

{% block inline_styles %}
#panel {
    display: none;
}
{% endblock inline_styles %}

{% block project_content %}
<div class="span-14 first last">
	<div class="frame">
		<div class="space20">
			<h1 style="margin:0; padding:0; color:#00ABFA;">{{p.name}}</h1>
			<p class="grey">{{p.subtitle}}</p>
		</div>
		
        <div id="container-1">
            <ul>
                <li><a href="#tab_summary"><span>{% trans 'Summary' %}</span></a></li>
                <li><a href="#tab_goals"><span>{% trans 'Goals' %}</span></a></li>
                <li><a href="#tab_details"><span>{% trans 'Details' %}</span></a></li>
                <li><a href="#tab_impact"><span>{% trans 'Impact' %}</span></a></li>
            </ul>
            <div style="width: 170px; margin-top: 20px; float:right;">
                <div class="space20" style="">
                    <h2>{% trans 'Location' %}</h2>
                    {% map_thumb p 140 140 '' %}
                    <p class="tiny" style="margin-top:5px;">
                        {{p.country.get_continent_display}}<br>
                        {{p.city}}, {{p.country}}<br>
                        {{p.longitude}} {{p.latitude}}
                    </p>
                </div>
            </div>
            <div id="tab_summary" class="tab">
                <div class="space20" style="width: 550px; border-right:1px solid #BBBBC5;">
                    <div style="float:right; width:120px;">
                        {% category_icons p %}
                    </div>
                    {% project_thumb p 400 300 'margin: 0 10px 10px 0;' %}
                    <p style="margin-right:20px;">
                        {{ p.project_plan_summary|capfirst|linebreaks }}
                    </p>
                </div>
            </div>
            <div id="tab_goals" class="tab">
                <div class="space20" style="width: 550px; border-right:1px solid #BBBBC5;">
                    <div class="space10" style="width: 170px; float:right;">
                        <ul>
                            {% if p.goal_1 %}
                                <li>{{p.goal_1}}</li>
                            {% endif %}
                            {% if p.goal_2 %}
                                <li>{{p.goal_2}}</li>
                            {% endif %}
                            {% if p.goal_3 %}
                                <li>{{p.goal_3}}</li>
                            {% endif %}
                            {% if p.goal_4 %}
                                <li>{{p.goal_4}}</li>
                            {% endif %}
                            {% if p.goal_5 %}
                                <li>{{p.goal_5}}</li>
                            {% endif %}
                        </ul>
                    </div>
                    <p>
                        {{p.goals_overview|capfirst|linebreaks}}
                    </p>
                </div>
            </div>
            <div id="tab_details" class="tab">
                <div class="space20" style="width: 550px; border-right:1px solid #BBBBC5;">
                    <h2>{% trans 'Details of current status' %}</h2>
                    <p>
                        {{p.current_status_detail|capfirst|linebreaks}}
                    </p>
                    <h2>{% trans 'Details of project plan' %}</h2>
                    <p>
                        {{p.project_plan_detail|capfirst|linebreaks}}
                    </p>
                </div>
            </div>
            <div id="tab_impact" class="tab">
                <div class="space20" style="width: 550px; border-right:1px solid #BBBBC5;">
                    <h2>{% trans 'Impact' %}</h2>
                    <p>
                        {{p.impact|capfirst|linebreaks}}
                    </p>
                    <h2>{% trans 'Lessons learned' %}</h2>
                    <p>
                        {{p.lessons_learned|capfirst|linebreaks}}
                    </p>
                    <h2>{% trans 'Technologies used' %}</h2>
                    <p>
                        {{p.technologies_used|capfirst|linebreaks}}
                    </p>
                </div>
            </div>
        </div>
		<div class="clear small" style="">&nbsp;</div>
		
	</div>
</div>
{# lower area starts #}
<div class="span-10 first">
    <div id="container-2">
		<ul>
            <li><a href="#tab_updates"><span>{% trans 'Latest updates' %}</span></a></li>
            <li><a href="#tab_comments"><span>{% trans 'Comments' %}</span></a></li>
        </ul>
        <div style="border:1px solid #BBBBC5; border-top: 0;">
            <div id="tab_updates" class="tab">
                <div class="space20">
                    <p class="clear">
                        {% if can_add_update %}
                            <a href="{% url akvo.rsr.views.updateform p.id %}"
                               style="float:right;">
                                    {% trans 'Add update' %}
                            </a>
                        {% endif %}
                        <a href="/rsr/rss/updates/{{p.id}}/"
                           style="background: url('{{MEDIA_URL}}base/img/icon_rss.gif') no-repeat right; padding-right: 1em;">
                                {% trans 'Subscribe via RSS' %}
                        </a>
                    </p>
                    {% updates updates %}
                </div>
                <div class="space10">
                    <hr />
                </div>
                <div class="space20">
                    <a href="{% url project_updates p.id %}" class="small" style="float:right; padding:0;">
                        {% trans 'Earlier updates' %}
                    </a>
                    <p class="small">
                        {% trans 'The updates are owned by whoever posted them. We are not responsible for them in any way.' %}
                    </p>
                </div>
            </div>
            <div id="tab_comments" class="tab">
                <div class="space20">
                    <p class="">
                    <a class="btn-slide" style="float:right" href="#" onclick="this.blur();"><span>{% trans 'Add comment' %}</span></a>
                    </p>
                    <div class="clear" style="">&nbsp;</div>
                    <div id="panel">
                        {% if not user.username %}
                            <p>{% trans 'You must be signed in to add a comment' %}</p>
                            <p><a href="{% url akvo.rsr.views.login %}?next={{request.path}}">{% trans 'Sign In' %}</a> <!--| <a href="#">Register</a></p>-->
                        {% else %}
                            <form enctype="multipart/form-data" method="post" action="comment">
                                {{form.comment}}
                                <p><a href="#" class="btn-slide">{% trans 'Cancel' %}</a></p>
                                <input type="submit" value="{% trans 'Submit' %}" class="submit" />
                            </form>
                        {% endif %}
                    </div> <!-- #panel -->        
                    {% if comments %}            
                        {% for c in comments %}    
                            <div style="float:left; width: 90px; margin: 3px 10px 0px 0px;">
                                <img src="{{MEDIA_URL}}base/img/avatar.jpg" style="width:60px;height:60px;background-color:#dedede;margin-left: 15px;" />
                                <p style="margin-top: 10px">{{c.user.get_full_name}}</p>
                            </div>						
                            <div style="margin-left: 110px">
                                <p class="lightx1">{{c.time|date:"Y-m-d H:i"}}</p>
                                <p>{{c.comment|linebreaks}}</p>
                            </div>
                            <br />
                            <p style="text-align:right">
                                <a href="mailto:abuse@akvo.org?subject={% blocktrans with p.id as p_id and c.id as c_id %}Comment abuse in project #{{p_id}}, comment #{{c_id}}{% endblocktrans %}">{% trans 'Report abuse' %}</a>
                            <hr style="clear: both"/>
                        {% endfor %}
                        <!--<p style="text-align:right;"><a href="{% url akvo.rsr.views.projectcomments p.id %}">{% trans 'Older comments' %}</a></p>-->
                        <p class="lightx1">{% trans 'The comments are owned by whoever posted them. We are not responsible for them in any way.' %}</p>
                    {% else %}
                        <span style="padding-left: 20px;" class="lightx1">{% trans 'No comments yet.' %}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="span-4 last">
	<p class="tiny grey" style="margin:0;padding:0;margin-bottom:14px;text-align:right;">
		Akvo Ref: {{ p.id }}
	</p>
	<div class="frame" style="">
		<div class="space15">
			<h2 style="color:#00ABFA;">{% trans 'Related to this project' %}...</h2>
			<h4>{% trans 'Knowledgebase entries' %}</h4>			
			<ul class="small">
			{% for link in p.link_set.all %}
				{% ifequal link.kind 'A' %}
					<li><a href="{{link.url}}">{{link.caption}}</a></li>
				{% endifequal %}
			{% endfor %}
			</ul>

            <h4>{% trans 'External links' %}</h4>
			<ul class="small">
			{% for link in p.link_set.all %}
				{% ifequal link.kind 'E' %}
		            <li><a href="{{link.url}}">{{link.caption}}</a></li>
				{% endifequal %}
			{% endfor %}
			</ul>			
		</div>
	</div>
</div>

{% endblock project_content %}
{% block js %}
{{ block.super }} 
<script src="{{MEDIA_URL}}js/ui.tabs.pack.js" type="text/javascript"></script>
<script type="text/javascript">

$(function(){
	$('#container-1 > ul').tabs();
});
$(function(){
	$('#container-2 > ul').tabs();
});

$(document).ready(function(){
    $(".btn-slide").click(function(){
        $("#panel").slideToggle("slow");
        $(this).toggleClass("active"); return false;
    });
});

</script>
{% endblock js %}

{% block jquery_ready %}
	{{ block.super }}
{% endblock jquery_ready %}	

