{% extends "rsr/base.html" %}

{% load webdesign addparam cache generic_content humanize i18n rsr_filters rsr_tags thumbnail counter_tags %}

{% block title %}{{p.name}}{% endblock title %}

{% block head %}
<link rel="alternate" type="application/rss+xml" title="Updates to {{p.name}}" href="/rsr/rss/updates/{{p.id}}/">
{% endblock head %}

{% block breadcrum_items %}
{{block.super}}
<li><a href="/rsr/projects/"><span>{% trans 'Projects' %}</span></a></li>

<div style="float:right; margin-right:10px;">
	<span style="display:none;">{% counter p %}</span>
	<p style="margin:0; color:#999; margin-top:5px;" class="small">
	{% cache 10 p.view_count %}
		{{ p.view_count|intcomma }} {% trans 'views' %}
	{% endcache %}
	</p>
</div>

{% comment %}
<span style="color:#999; font-size:10px; font-weight:normal; margin-left:20px; "><span style="display:none;">{% counter p %}</span>
	{% cache 10 p.view_count %}
		{{ p.view_count|intcomma }} {% trans 'views' %}
	{% endcache %}
</span>
{% endcomment %}
{% endblock breadcrum_items %}

{% block maincontent %}
<div class="two_column_left">
	<h1 style="margin-bottom:5px;">{{p.name}}</h1>
	<p class="grey" style="font-weight:bold;">{{p.subtitle}}</p>
	{% block project_left_column %}{% endblock project_left_column%}
</div>

<div class="two_column_right">
	<div id="project_status" class="two_column_right_inner">
		<div style="margin:15px; padding:20px 0px;">
			{{p.show_status_large}}<br />
			<div style="margin-top:15px;">
				<h3 style="color:#A3FFFF;">Funding</h3>
				<div class="round" style="background-color:#fff;">
					
					<div style="width:172px; margin-left:auto; margin-right:auto; padding-top:15px; padding-bottom:15px">
						{% funding_table p %}
					</div>
					{% comment %}
					<p style="padding:10px; margin-bottom:0;">
						{{p.get_currency_display|safe}} {{p.budget_total|round|intcomma}} Requested<br />
						{{p.get_currency_display|safe}} {{p.funding_total_given|round|intcomma}} Raised<br />
						{{p.get_currency_display|safe}} {{p.funding_still_needed|round|intcomma}} Still needed<br />
					</p>	
					{% endcomment %}
					{% ifnotequal p.funding_still_needed|round 0 %}
						<div style="text-align:center; padding-bottom:10px;">
							<a class="aqua awesome" href="{% url project_donate p.id %}">{% trans 'Donate' %}</a>
						</div>
					{% endifnotequal %}
				</div>
				<p class="small space0" style="padding-top:10px;">
					<a style="color:#FDF47A;" href="{% url project_funding p.id %}">
						{% trans 'See funding details' %} &#x25B6;
					</a>
				</p>
			</div>
			
			{% comment %}
			{{p.show_status_large}}<br /><br />
			<div style="width:175px; float:left; margin:0; padding:0;">
				<h4 style="color:#A3FFFF;">Funding</h4>
				<div class="round" style="background-color:#fff; width:144px">
					<p class="tiny" style="padding:10px;">
						{{p.get_currency_display|safe}} {{p.budget_total|round|intcomma}} Requested<br />
						{{p.get_currency_display|safe}} {{p.funding_total_given|round|intcomma}} Raised<br />
 						{{p.get_currency_display|safe}} {{p.funding_still_needed|round|intcomma}} Still needed<br />
						<br />
						<a class="yellow awesome" href="{% url project_donate p.id %}">{% trans 'Donate' %}</a>
					</p>
				</div>
			</div>
			<div style="width:85px; float:right; margin:0; padding:0;">
				<h4 style="color:#A3FFFF;">Schedule</h4>
				<p class="tiny white">
					Begun<br />
					03 Mar 2010<br />
					<br />
					Expected finish<br />
					03 Dev 2010<br />
				</p>
			</div>
			<div class="clear"></div>
			<p class="small space0">
				<a style="color:#FDF47A;" 
					href="{% url project_funding p.id %}">See funding and milestone details &#x25B6;</a>
			</p>
			{% endcomment %}
		</div>
	</div>
	
	{# If no updates or at the updates listing page #}
	{# {% if not hide_latest_updates and updates %} #}
	{% if not hide_latest_updates %}
		{% if not updates %}
			<div class="two_column_right_inner">
				<div class="small">
					<h2>No updates yet</h2>
				</div>
			</div>
		{% else %}
			<div class="two_column_right_inner">
				<div class="small" style="float:left; width:130px;">
					<h2>Latest updates</h2>
				</div>
				<div class="small" style="margin:2px 0; float:right; width:130px; text-align:right;">
					<a class="small" href="{% url project_updates p.id %}">See all updates &#x25B6;</a>
				</div>
				<div class="clear"></div>
			</div>

			{% for update in updates %}
				<div style="background-color:#AFF167;padding:2px; padding-left:15px">
					<p class="small" style="margin:0;padding:0; font-weight:bold;">{{update.time|date:"d-M-Y"}}</p>
				</div>
				<div class="two_column_right_inner" style="background-color:#fff;">
					<div style="border:1px solid #ccc; border-top:none; margin-bottom:10px;">
						{% if update.photo %}					
							<div style="float:left; width:175px;">
								<p class="small" style="padding:5px; margin-bottom:5px;">
									<b><a href="{% url project_update p.id update.id %}">{{update.title}}</a></b><br />
									{{update.text|smart_truncate:50}}
								</p>
							</div>
							<div style="float:left; width:116px; text-align:center;">
								<img src="{% thumbnail update.photo 116x87 autocrop sharpen %}" alt="{{update.photo_caption}}" style="margin:0;" />
							</div>
							<div class="clear"></div>
						{% else %}
							<p class="small" style="padding:5px; margin-bottom:5px;">
								<b><a href="{% url project_update p.id update.id %}">{{update.title}}</a></b><br />
								{{update.text|smart_truncate:100}}
							</p>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		{% endif %}
	{% endif %}
	
	<div class="two_column_right_inner" style="margin-top:20px;">
		<h2>Tools for this page</h2>
		<div class="white_box" style="background-color:#fff">
			<div class="space20">
				<ul>
					{% if can_add_update %}
						<li><a href="{% url akvo.rsr.views.updateform p.id %}">{% trans 'Add update' %}</a></li>
					{% endif %}
					<li><a href="{% url project_get_widget p.id %}">{% trans 'Get a widget' %}</a></li>
					<li><a href="{% url project_main p.id %}">{% trans 'Permalink' %}</a></li>
					<li><a href="/rsr/rss/updates/{{p.id}}/">{% trans 'Project feed' %}</a></li>
				</ul>	
			</div>
		</div>
	</div>
	
	{% if not hide_project_partners %}
		<div class="two_column_right_inner" style="margin-top:20px;">
			<div class="small" style="float:left; width:130px;">
				<h2>{% trans 'Project partners' %}</h2>
			</div>
			<div class="small" style="margin:2px 0; float:right; width:130px; text-align:right;">
				<a class="small" href="{% url project_partners p.id %}">{% trans 'See details' %} &#x25B6;</a>
			</div>
			<div class="clear"></div>
			<div class="white_box">
				<div class="space10">
					{% for partner in p.all_partners %}
						<div style="float:left; width:110px;">
							<a href="{% url partners_partner partner.id %}">
								{% org_logo partner 98 60 'margin:0;' %}
							</a>
						</div>
						<div style="float:left; width:160px;">
							<p class="small grey" style="margin:0; padding:=;">
								<a href="{% url partners_partner partner.id %}">{{partner.name}}</a><br />
								{{partner.city}}, {{partner.country}}
							</p>
						</div>
						<div class="clear"></div>
						{% if not forloop.last %}
							<hr style="margin-bottom:12px; margin-top:10px;"/>
						{% endif %}
					{% endfor %}
				</div>
			</div>
		</div>
		<br />
	{% endif %}
	
	{% if not hide_comments %}
		<div class="two_column_right_inner" style="margin-top:20px;">
			<div class="small" style="float:left; width:130px;">
				<h2>{% trans 'Comments' %}</h2>
			</div>
			<div class="small" style="margin:2px 0; float:right; width:130px; text-align:right;">
				<a class="small" href="{% url project_comments p.id %}">{% trans 'All comments' %} &#x25B6;</a>
			</div>
			<div class="clear"></div>
			<div class="white_box">
				<div class="space10">
					{% for comment in comments %}
						{{ comment.comment }}
						
						{% comment %}						
						<div style="float:left; width:110px;">
							<a href="{% url partners_partner partner.id %}">
								{% org_logo partner 98 60 'margin:0;' %}
							</a>
						</div>
						<div style="float:left; width:160px;">
							<p class="small grey" style="margin:0; padding:=;">
								<a href="{% url partners_partner partner.id %}">{{partner.name}}</a><br />
								{{partner.city}}, {{partner.country}}
							</p>
						</div>
						<div class="clear"></div>
						{% endcomment %}
						{% if not forloop.last %}
							<hr style="margin-bottom:12px; margin-top:10px;"/>
						{% endif %}
					{% endfor %}
				</div>
			</div>
		</div>
		<br />
	{% endif %}
		
	<div class="two_column_right_inner">
		<p class="grey tiny" style="text-align:right;">Akvo Ref: {{p.id}}</p>
	</div>
</div>
{% endblock maincontent %}