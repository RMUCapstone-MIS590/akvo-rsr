{% extends "rsr/base.html" %}

{% load i18n webdesign rsr_filters thumbnail counter_tags cache humanize %}
{% load oembed_tags markup_tags google_maps %}

{% block inline_styles %}
#feature_box {
	background: transparent url({% thumbnail cms.feature_image 645x363 sharpen autocrop crop upscale %}) no-repeat;
}
{% endblock inline_styles %}

{% block breadcrum  %}{% endblock breadcrum  %}

{% block maincontent %}

{% if preview %}
  <div id="preview_cover"></div>
  <div id="preview_alert">
    <h1 style="color: yellow;">{% trans 'Preview!' %}</h1><a href="{% url admin:rsr_minicms_change cms.pk %}">{% trans 'Return to admin' %}</a>
  </div>
{% endif %}

<div class='container'>

  <div class='column span-12'>
    <div class='column span-12'>
      <div id="feature_box" class="white_box">
        {{cms.feature_box|apply_markup:"markdown"}}
      </div>
    </div>
  
    <div class='column span-12'>
      <div class="white_box gutter-top" style="background-color:#f1f1f1;">
        <div class="space5"> 
          <h5 style="display: inline; padding-left: 15px;">Latest news: </h5><a href="{{news_post.url}}" class="small_link">{{news_post.title}}</a>
        </div> 
      </div> 
    </div> 
    
    <div class='column span-12 gutter-top'>
      {% for update in updates %}
      <div class='column span-4{% if forloop.last %} last{% endif %}'>
        <div class="white_box" style="min-height: 320px;">
					{% if update.photo %}
            <a href="{% url project_update update.project.id update.id %}">
              <img src="{% thumbnail update.photo 203x152 autocrop sharpen %}" style="margin:0;"  alt="foo"  title="bar"/>
            </a>
          {% endif %}
          <div class="space10">
            <a href="{% url project_update update.project.id update.id %}">
              <h2 class="link_blue">{{update.title|smart_truncate:40}}</h2>
            </a>
            <p class="small grey" style="margin-bottom: 0">
              {% blocktrans with update.user.get_full_name as user_name and update.user.userprofile.organisation.name as user_org and update.user.userprofile.organisation.get_absolute_url as org_url and update.get_update_method_display as update_meth and update.time|date:"Y-m-d" as update_time %}By {{user_name}}, <a href="{{org_url}}">{{user_org}}</a>, via {{update_meth}} on {{update_time}}{% endblocktrans %}
              <br/>{{update.project.country}}
            </p>
            <p class="small" style="">
              {{update.text|smart_truncate:100}}
            </p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    
    <div class='column span-12 gutter-top'>
        
      <div class="white_box" style="background-color:#fff; min-height: {{cms.lower_height}}px;">
        <div class="space20">
          <div style="float: left;">
            <h1>{% trans 'Recent articles' %}</h1> 
          </div>
          <div class="h1_companion">
            <a class="" href="/news/?feed=rss2">
              RSS
              <img src="{{MEDIA_URL}}core/img/icon_rss.gif" width="12" height="12" alt="Icon Rss"  style="margin-left:5px; margin-right:0">
            </a>
          </div>
        </div> 
        <div class="clear"></div>
        {% for blog_post in blog_posts %}
          <div class="space20" style="margin-top: 0;">
            <p><a class="strong" href="{{blog_post.url}}">{{blog_post.title}}</a></p>
            <p class="nano-lede lt_grey">{{blog_post.date|date:"l, j F Y"}}</p> 
            {% if blog_post.image %}
              <div class="clear"></div>
              <img src="{{blog_post.image}}" width="123" style="margin: 0 10px 10px 0; float: left;">
            {% endif %}
            <p class="nano-lede">{{blog_post.text|striptags|smart_truncate:160}}</p> 
          </div>
          <div style="margin: 0 8px;"><hr/></div>
        {% endfor %}
        <div class="h1_companion" style="margin: 20px; margin-top: 5px;">
          <a href="/news">View earlier articles <span class="link_triangle">&#x25B6;</span></a>
        </div>          
        <div class="clear"></div>
      </div>

    </div>
  </div>
     
  <div class='column span-6 last'>
    <div class="white_box" style="height: 361px; background:url({{MEDIA_URL}}akvo/img/earth-300x78.png) no-repeat bottom;">
      <div id="top_right_box" class="space20">
        {{cms.top_right_box|apply_markup:"markdown"}}
      </div>
    </div> 
  </div>

  <div class='column span-6 gutter-top last'>
    <div class="right_now_box">
      <div style="padding: 20px 20px 0px 20px;">
        <h1 class="right_now_green">{% trans 'Right now in Akvo.org...' %}</h1>
        <div class="clear"></div>
      </div>
      <div class='column span-3 border' style="margin-bottom:20px">
        <div style="padding-left: 20px;">
          <h1 class="white last" style="line-height: 1em">{{projects.count}}</h1>
          <p class="small right_now_blue">{% trans 'Projects' %}</p>
          <h1 class="white last" style="line-height: 1em">{{orgs.count}}</h1>
          <p class="small right_now_blue last">{% trans 'Project partners' %}</p>
          <!--<h1 class="white last" style="line-height: 1em">000</h1>
          <p class="small lt_grey last">{% trans 'Countries' %}</p>-->
        </div>
      </div>
      <div class='column span-3 last' style="margin-bottom:20px">
        <div style="padding-left: 20px;">
          <h1 class="white last" style="line-height: 1em">{{people_served|intcomma}}</h1>
          <p class="small lt_grey">{% trans 'People served' %}</p>
          <h1 class="white last" style="line-height: 1em">â‚¬ {{projects_total_total_budget}}M</h1>
          <p class="small lt_grey last">{% trans 'Project bugets' %}</p>
        </div>
      </div>
      <a href="{% url global_project_map %}">
        {% google_global_project_map 'static' 315 235 0 %}
      </a>
      <div style="padding: .5em .5em .7em .5em;">
        <a class="right small right_now_blue" href="{% url global_project_map %}">View large map <span class="link_triangle">&#x25B6;</span></a>
        <div class="clear"></div>
      </div> 
    </div> 
  </div>

<!--
-->
  <div class='column span-6 gutter-top last'>
    <div class="white_box" style="background-color:#fff;">
      <div style="margin: 20px 20px 0px 20px;">     
        <div style="float: left;">
          <h1 style="margin-bottom: 18px;">Focus areas</h1> 
        </div>
        <div class="h1_companion">
          <a href="/web/focus-areas">See all <span class="link_triangle">&#x25B6;</span></a>
        </div>
        <div class="clear"></div>
      </div>
    </div>
    <div id="index-accordion" style="height: {{cms.lower_height|add:-69}}px;">
      <div id="accordion">
        {% for focus_area in focus_areas %}
        <h3><a href="#">{{focus_area.name}}</a></h3>
        <div>
          <img src="{% thumbnail focus_area.image 275x206 sharpen %}" alt="{{focus_area}}"/>
            {{focus_area.description|smart_truncate:120|apply_markup:"markdown"}}
            <div class="h1_companion">
              <a style="color: #1877B8;" href="{% if focus_area.link_to %}{{focus_area.link_to}}{% else %}{{ focus_area.get_absolute_url }}{% endif %}">Read more <span class="link_triangle">&#x25B6;</span></a>
            </div>
        </div>
        {% endfor %}
      </div>              
    </div>          
  </div>
    
</div> 


{% endblock maincontent %}

{% block js %}
	{{ block.super }}
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js"></script>
	<script>
		!window.jQuery && document.write('<script src="{{MEDIA_URL}}akvo/js/src/jquery-ui-1.8.5.custom.min.js"><\/script>')
	</script>
{% endblock js %}

{% block jq_ready %}
	{{ block.super }}
  $("#accordion").accordion();
  $("#accordion").accordion({ fillSpace: true });
  $("#accordion").accordion( "resize" )
{% endblock jq_ready %}
