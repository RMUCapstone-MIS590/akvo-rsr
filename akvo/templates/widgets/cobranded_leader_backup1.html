{% extends "widgets/base_widget.html" %}
{% comment %}
Akvo RSR is covered by the GNU Affero General Public License, see more details in the license.txt file located at the root folder of the Akvo RSR module. 
For additional details on the GNU license please see < http://www.gnu.org/licenses/agpl.html >.
{% endcomment %}

{% load i18n rsr_tags rsr_filters generic_content thumbnail %}

{% block title %}project@{{block.super}}{% endblock title %}

{% block style %}
	 <link rel="stylesheet" href="{{MEDIA_URL}}widgets/cobranded_leader/css/screen.css" type="text/css" media="screen, projection" />
	<!--[if IE]>
	<style type="text/css" media="screen">
		.divider { 
			margin-top:1px !important;
			margin-bottom:1px !important;
		}
	</style>
	<![endif]-->
{% endblock style %}

{% block inline_styles %}
{{block.super}}
	#heightconstrain {
		height: expression( this.scrollHeight > 809 ? "810px" : "auto" ); /* sets max-height for IE */
		max-height:810px;
		overflow:hidden;
	}
	.fundingbox-content {
		height: expression( this.scrollHeight > 4 ? "123px" : "auto" ); /* sets max-height for IE */
		max-height:121px;
		height:121px;
	}
	
	#progress_back {
		background: url({{MEDIA_URL}}widgets/img/progressbar_background.png);
	}
	#progress_green {
		background: url({{MEDIA_URL}}widgets/img/progressbar_green.png);
	}
	#footer {
		background-color:#9B9AAC;
		height:1px !important;
		overflow: hidden;
		line-height:0px;
		border-bottom:0px solid #9B9AAC;
	}

{% endblock inline_styles %}

{% block inline_scripts %}
<script src="{{MEDIA_URL}}js/jquery-1.2.6.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8">
	
	var index = 1;
	
	function Partner (orgName,logo,partnerType,url)Â {
		this.orgName = orgName;
		this.logo = logo;
		this.partnerType = partnerType
		this.url = url
		this.getName = function () { return this.orgName; }
		this.getLogo = function () { return this.logo; }
		this.getType = function () { return this.partnerType; }
		this.getUrl = function () { return this.url; }
	}
	
	var partners = [];
	
	{% for sponsor in project.sponsorpartner_set.all %} 
	partners[partners.length] = new Partner('{{sponsor.sponsor_organisation.name}}',
											'{% thumbnail sponsor.sponsor_organisation.logo 140x50 autocrop,upscale,sharpen %}',
											'support',
											'{% url akvo.rsr.views.orgdetail sponsor.sponsor_organisation.id %}');
	{% endfor %}
	
	{% for funder in project.fundingpartner_set.all %}
	partners[partners.length] = new Partner('{{funder.funding_organisation.name}}',
											'{% thumbnail funder.funding_organisation.logo 140x50 autocrop,upscale,sharpen %}',
											'funding',
											'{% url akvo.rsr.views.orgdetail funder.funding_organisation.id %}');
	{% endfor %}
	
	{% for supporter in project.supportpartner_set.all %}
	partners[partners.length] = new Partner('{{supporter.support_organisation.name}}',
											'{% thumbnail supporter.support_organisation.logo 140x50 autocrop,upscale,sharpen %}',
											'support',
											'{% url akvo.rsr.views.orgdetail supporter.support_organisation.id %}');
	{% endfor %}

	{% for operator in project.fieldpartner_set.all %}
	partners[partners.length] = new Partner('{{operator.field_organisation.name}}',
											'{% thumbnail operator.field_organisation.logo 140x50 autocrop,upscale,sharpen %}',
											'field',
											'{% url akvo.rsr.views.orgdetail operator.field_organisation.id %}');
	{% endfor %}
	
	function switchPartner()
	{
		var newHTML = "";
		
		switch(partners[index].getType())
		{
			case "funding": newHTML += '<p class="smallFont grey left">{% trans 'Underwritten by ' %}'; break;
			case "support": newHTML += '<p class="smallFont grey left">{% trans 'Supported by ' %}'; break;
			case "field": 	newHTML += '<p class="smallFont grey left">{% trans 'Implemented by ' %}'; break;
			default: newHTML += '<p class="smallFont grey left">{% trans 'Presented by ' %}'; break;
		}
		
		newHTML += '<a class="smallFont" href="' + partners[index].getUrl() + '">' + partners[index].getName() +'</a></p>';
		
		$("#partnerspace").fadeOut("slow", function() {
			$("#partnerspace").html(newHTML).fadeIn('slow');	
		});
	
		index == (partners.length-1) ? index = 0 : index++;		
	}
	
	$(document).ready(function()
	{
		window.setInterval(function() { this.switchPartner.apply(this); }, 2000)		
	});		
</script>
	
{% endblock inline_scripts %}

	
{% block header %}
<div class="widget_cobranded_banner-container" style="margin:0; padding:0; ">
	<div class="widget_cobranded_banner-first widget_cobranded_banner-span-6">
		<h1 style="width:200px; display:inline;">{% trans 'Project' %}</h1>
	</div>
	<div class="widget_cobranded_banner-last widget_cobranded_banner-span-6" style="text-align:right; margin-bottom:0;">
		<img src="{{MEDIA_URL}}widgets/img/Akvo-badge-grey.png" width="100" height="30" alt="Akvo.org" />
	</div>
</div>

{% endblock header %}

{% block content %}
<div id="heightconstrain">
	<div style="background-color:#ccc;">
		<div style="width:308px; float:left;">
			<h2 id="project_title"><a href="{% url akvo.rsr.views.projectmain project.id %}">{{project.name|smart_truncate:35}}</a></h2>
			<p id="project_subtitle" class="grey">{{project.subtitle|smart_truncate:50}}</p>
			<div style="width:150px; float:left;">
			{% if project.current_image %}
				<div class="photo_frame">
					<a href="{% url akvo.rsr.views.projectmain project.id %}">
						<img src="{% thumbnail project.current_image 150x113 autocrop,upscale,sharpen%}">
					</a>
					<p class="miniFont lightgrey left" style="margin-top:1px; margin-bottom:5px; text-transform: capitalize;">{% trans 'Ref' %}: {{project.id}}</p>
				</div>
		    {% endif %}
			</div>
			<div style="width:140px; margin-left:10px; float:left;">
				<p class="smallFont grey topmargin">{% trans 'Location' %}</p>
				<p class="smallFont"><span class="capz">{{project.country.get_continent_display}}</span><br />
					{{project.country}}, {{project.city}}
				</p>
				<p class="smallFont grey topmargin">{% trans 'Status' %}</p>
				<p class="smallFont">{{project.show_status}}</p>
			</div>

			<div style="clear:both;"> </div>
			{% comment %}
				start
			{% endcomment %}
			<div id="partnerspace">
				{% if project.sponsorpartner_set.all %}
					{% for sponsor in project.sponsorpartner_set.all %}
						{% if forloop.first %}
						<p class="smallFont grey left">{% trans 'Presented by' %} <a class="smallFont" href="{% url akvo.rsr.views.orgdetail sponsor.sponsor_organisation.id %}">{{sponsor.sponsor_organisation.name}}1</a></p>
						{% endif%}
					{% endfor %}
				{% else %}
					{% if project.fundingpartner_set.all %}
						{% for funder in project.fundingpartner_set.all %}
							{% if forloop.first %}
							<p class="smallFont grey left">{% trans 'Underwritten by' %} <a class="smallFont" href="{% url akvo.rsr.views.orgdetail funder.funding_organisation.id %}">{{funder.funding_organisation.name}}2</a></p>
							{% endif%}
						{% endfor %}
					{% else %}
						{% if project.supportpartner_set.all %}
							{% for supporter in project.supportpartner_set.all %}
								{% if forloop.first %}
								<p class="smallFont grey left">{% trans 'Supported by' %} <a href="{% url akvo.rsr.views.orgdetail supporter.support_organisation.id %}">{{supporter.support_organisation.name}}3</a></p>
								{% endif%}
							{% endfor %}
						{% else %}
							{% if project.fieldpartner_set.all %}
							{% for operator in project.fieldpartner_set.all %}
								{% if forloop.first %}
								<p class="smallFont grey left">{% trans 'Implemented by' %} <a href="{% url akvo.rsr.views.orgdetail operator.field_organisation.id %}">{{supporter.support_organisation.name}}3</a></p>
								{% endif%}
							{% endfor %}
							{% endif %}
						{% endif %}
					{% endif %}
				{% endif %}
			</div>
			
			{% comment %}
				stop
			{% endcomment %}
		
		</div>
		<div style="width:150px; margin-left:0; float:left;">
			<div style="margin:0; margin-top:13px;">
				{% funding_box_narrow2 project %}
			</div>
		</div>
	</div>	
		
</div>
{% endblock content %}

{% block footer %}
	
{% endblock footer %}

