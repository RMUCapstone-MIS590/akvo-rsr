{% extends "rsr/index_base.html" %}
{% load generic_content %}
{% load addparam %}

{% block title %}Akvo RSR - Project listing{% endblock title %}

{% block script %}
{{block.super}}
<script src="{{MEDIA_URL}}js/ui.tabs.pack.js" type="text/javascript"></script>
{% endblock script %}

{% block breadcrumbs %}
{{block.super}} &raquo; Project listing
{% endblock breadcrumbs %}

{% block page_id %}
<div id="page_project_directory">
{% endblock page_id %}

{% block outer_leftwing %}

<div id="outer_leftwing">

	<div class="boxhead">
		<h1 class="section">Featured projects</h1>
	</div> <!-- .boxhead -->

<div class="boxbody">
	<table id="project_showcase" style="width: 95%;">
	{% get_random_objects rsr.Project 3 as showcases %}
	<tr>
	{% for showcase in showcases %}
	<td style="width: 33%;{% if not forloop.last %}border-right: 1px solid #ccc;{% endif %}">
		<h2><a href="{% url akvo.rsr.views.projectmain showcase.id %}">{{showcase.name}}</a></h2>
		<div class="small lightx2">{{showcase.subtitle}}</div>
		{% if showcase.current_image %}
			<a href="{% url akvo.rsr.views.projectmain showcase.id %}">
			<img src="{{MEDIA_URL}}{{showcase.current_image}}" alt="{{showcase.current_image_caption}}" style="height: 105px; margin: 10px 0" />
			</a>
			<p class="small lightx2">{{showcase.current_image_caption}}</p>
		{% else %}
			<div style="width: 140px; height: 105px; background-color: #ccc; margin: 10px 0"></div>
		{% endif %}	
		<p><span class="lightx2">Status:</span> {{showcase.show_status}}</p>
		<p class="lightx2">Focus areas</p>
			{% if showcase.category_sanitation %}
				 <img src="{{MEDIA_URL}}img/purple.png" alt="type" style="margin: 10px 5px 10px 0;" />
			 {% endif %}
			 {% if showcase.category_water %}
				 <img src="{{MEDIA_URL}}img/blue.png" alt="type" style="margin: 10px 5px 10px 0;" />
			 {% endif %}
			 {% if showcase.category_maintenance %}
				 <img src="{{MEDIA_URL}}img/orange.png" alt="type" style="margin: 10px 5px 10px 0;" />
			 {% endif %}
			 {% if showcase.category_training %}
				 <img src="{{MEDIA_URL}}img/green.png" alt="type" style="margin: 10px 5px 10px 0;" />
			 {% endif %}
			 {% if showcase.category_education %}
				 <img src="{{MEDIA_URL}}img/olive.png" alt="type" style="margin: 10px 5px 10px 0;" />		
			 {% endif %}
		<p class="lightx2">Location</p>
		<p>{{showcase.state}}<br />{{showcase.city}}, {{showcase.country}}<br />{{showcase.country.get_continent_display}}</p>
		<div style="border: 1px solid #ccc; width: 100%; margin: 15px 0 5px 0"><div style="background-color: #4CAC62; width: {% widthratio showcase.funding.pledged showcase.funding.total 100 %}%; height: 20px;"></div></div>
		<p class="bold">Total <span style="margin-left: 40px;">{{showcase.funding.get_currency_display|safe}} {{showcase.funding.total}}</span></p>
	</td>
	{% endfor %}
	
	</tr>
	</table>
</div> <!-- .boxbody -->

</div> <!-- #outer_leftwing -->
{% endblock outer_leftwing %}

{% block projects %}

<div class="boxhead" style="clear:both">
	<a name="list"></a>
    <div style="float:right; margin: 1em">
    <!--<label for="display_number_of_entries">Show</label>
    <select name='display_number_of_entries' class="select">
    <option value='25'>25</option>
    <option value='50'>50</option>
    <option value='75'>75</option>
    </select>
    results per page-->
		<span style="margin: 0 20px 0 20px">Projects {{page.start_index}}-{{page.end_index}} of {{projects.count}}</span>
		<span style="margin: 0 20px 0 20px">
			{% ifequal page.number 1 %}
			First |
			{% else %}
				{# if we have an organisation in the context, we are diplaying the list filtered on that org, url have to conform to that #}
				{% if o %}
					<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "page" 1 %}#list">First</a> |
				{% else %}
					<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" 1 %}#list">First</a> |
				{% endif %}
			{% endifequal %}
			{% if page.has_previous %}
				{% if o %}
					<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "page" page.previous_page_number %}#list">Previous</a> |
				{% else %}
					<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.previous_page_number %}#list">Previous</a> |
				{% endif %}
			{% else %}
			Previous |
			{% endif %}
			{% if page.has_next %}
				{% if o %}
					<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "page" page.next_page_number %}#list">Next</a> |
				{% else %}
					<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.next_page_number %}#list">Next</a> |
				{% endif %}
			{% else %}
			Next |
			{% endif %}
			{% ifequal page.number page.paginator.num_pages %}
			Last
			{% else %}
				{% if o %}
					<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "page" page.paginator.num_pages %}#list">Last</a>
				{% else %}
					<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.paginator.num_pages %}#list">Last</a>
				{% endif %}
			{% endifequal %}
		</span>
    </div>

    <h1>Project listing
		{% if o %}
			for {{o.name}}
		{% endif %}
		<span class="lightx2" style="font-weight:normal">({{projects.count}} total)</span>
	</h1>
</div> <!-- .boxhead -->

<div class="boxbody">

<table id="project_table">
<tr>
	<th>
	{% if o %}
		<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "order_by" "name" %}#list">Project name</a>
	{% else %}
		<a href="{% url akvo.rsr.views.projectlist %}{% addparam "order_by" "name" %}#list">Project name</a>
	{% endif %}
	</th>
	<th>
	{% if o %}
		<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "order_by" "status" %}#list">Status</a>
	{% else %}
		<a href="{% url akvo.rsr.views.projectlist %}{% addparam "order_by" "status" %}#list">Status</a>
	{% endif %}
	</th>
	<th>
	{% if o %}
		<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "order_by" "country__country_name" %}#list">Country</a>
	{% else %}
		<a href="{% url akvo.rsr.views.projectlist %}{% addparam "order_by" "country__country_name" %}#list">Country</a>
	{% endif %}
	</th>
	<th>
	{% if o %}
		<a href="{% url akvo.rsr.views.filteredprojectlist o.id %}{% addparam "order_by" "country__continent" %}#list">Continent</a>
	{% else %}
		<a href="{% url akvo.rsr.views.projectlist %}{% addparam "order_by" "country__continent" %}#list">Continent</a>
	{% endif %}
	</th>
	<th>Total funds requested</th>
	<th>Funding still needed</th>
	<th>Field partner(s)</th>
	<th>Support partner(s)</th>
	<th>Funding partner(s)</th>
</tr>
{% for p in page.object_list %}
<tr>
	<td>
		
	
		{% if p.current_image %}
			<a href="{% url akvo.rsr.views.projectmain p.id %}">
			<img src="{{MEDIA_URL}}{{p.current_image}}" alt="{{p.current_image_caption}}" style="width: 100px; float:left; margin-right: 10px;" />
			</a>
		{% else %}
			<div style="background-color: #ccc; width: 100px; height: 75px; float:left; margin-right: 10px"></div>
		{% endif %}	

		<a href="{% url akvo.rsr.views.projectmain p.id %}">{{p.name}}</a>
		<div class="lightx2 small">{{p.subtitle}}</div>
		<div style="clear: left;">
		{% if p.category_sanitation %}
			 <img src="{{MEDIA_URL}}img/purple.png" alt="type" title="" style="margin: 10px 5px 10px 0;" />
		 {% endif %}
		 {% if p.category_water %}
			 <img src="{{MEDIA_URL}}img/blue.png" alt="type" style="margin: 10px 5px 10px 0;" />
		 {% endif %}
		 {% if p.category_maintenance %}
			 <img src="{{MEDIA_URL}}img/orange.png" alt="type" style="margin: 10px 5px 10px 0;" />
		 {% endif %}
		 {% if p.category_training %}
			 <img src="{{MEDIA_URL}}img/green.png" alt="type" style="margin: 10px 5px 10px 0;" />
		 {% endif %}
		 {% if p.category_education %}
			 <img src="{{MEDIA_URL}}img/olive.png" alt="type" style="margin: 10px 5px 10px 0;" />		
		 {% endif %}
	 	</div>
	</td>
	<td>{{p.show_status}}</td>
	<td>{{p.country}}</td>
	<td>{{p.country.get_continent_display}}</td>
	<td>
		{% ifequal p.funding.still_needed 0 %}
			<span style="color: green">
		{% else %}
			<span>
		{% endifequal %}
		<b>{{p.funding.get_currency_display|safe}} {{p.funds_requested}}</b>
		</span>
	</td>
	<td>
		{% ifequal p.funding.still_needed 0 %}
			<span>
		{% else %}
			<span style="color: red">
		{% endifequal %}
		<b>{{p.funding.get_currency_display|safe}} {{p.funding.still_needed}}</b>
		</span>
	</td>
	<td>
	{% if p.fieldpartner_set.all %}
		{% for fieldpartner in p.fieldpartner_set.all %}
			<a href="{% url akvo.rsr.views.orgdetail fieldpartner.field_organization.id %}">{{fieldpartner.field_organization.name}}</a><br />
		{% endfor %}
	{% else %}
		&nbsp;
	{% endif %}
	</td>
	<td>
	{% if p.supportpartner_set.all %}
		{% for support in p.supportpartner_set.all %}
			<a href="{% url akvo.rsr.views.orgdetail support.support_organization.id %}">{{support.support_organization.name}}</a><br />
		{% endfor %}
	{% else %}
		&nbsp;
	{% endif %}
	</td>
	<td>
	{% if p.fundingpartner_set.all %}
		{% for funder in p.fundingpartner_set.all %}
			<a href="{% url akvo.rsr.views.orgdetail funder.funding_organization.id %}">{{funder.funding_organization.name}}</a><br />
		{% endfor %}		
	{% else %}
		&nbsp;
	{% endif %}
	</td>
</tr>

{% endfor %}

<tr>
	<td colspan="9">
		<div style="text-align: right">
			<!--<label for="display_number_of_entries">Show</label>
			<select name='display_number_of_entries' class="select">
				<option value='25'>25</option>
				<option value='50'>50</option>
				<option value='75'>75</option>
			</select>
			results per page-->
		<span style="margin: 0 20px 0 20px">Projects {{page.start_index}}-{{page.end_index}} of {{projects.count}}</span>
		<span style="margin: 0 20px 0 20px">
			{% ifequal page.number 1 %}
			First |
			{% else %}
			<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" 1 %}#list">First</a> |
			{% endifequal %}
			{% if page.has_previous %}
			<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.previous_page_number %}#list">Previous</a> |
			{% else %}
			Previous |
			{% endif %}
			{% if page.has_next %}
			<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.next_page_number %}#list">Next</a> |
			{% else %}
			Next |
			{% endif %}
			{% ifequal page.number page.paginator.num_pages %}
			Last
			{% else %}
			<a href="{% url akvo.rsr.views.projectlist %}{% addparam "page" page.paginator.num_pages %}#list">Last</a>
			{% endifequal %}
		</span>
		</div>
	</td>
</tr>
</table>

</div> <!-- .boxbody -->

{% endblock projects %}

